/* 
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD 
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => FlatTagPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian3 = require("obsidian");

// flatTagView.ts
var import_obsidian = require("obsidian");

// constants.ts
var VIEW_TYPE = "flat-tag-view";

// flatTagView.ts
var FlatTagView = class extends import_obsidian.ItemView {
  constructor(leaf, plugin) {
    super(leaf);
    this.selectedTags = /* @__PURE__ */ new Set();
    this.excludedTags = /* @__PURE__ */ new Set();
    this.allTags = /* @__PURE__ */ new Map();
    this.currentSort = "az";
    this.tagsByFile = /* @__PURE__ */ new Map();
    this.tagSearchText = "";
    this.searchMode = "note";
    this.touchTimer = null;
    this.lastInteractionWasTouch = false;
    this.plugin = plugin;
    this.containerEl.addClass("flat-tag-view");
  }
  getViewType() {
    return VIEW_TYPE;
  }
  getDisplayText() {
    return "Flat Tags";
  }
  getIcon() {
    return "tag";
  }
  async onOpen() {
    this.container = this.contentEl.createDiv({ cls: "flat-tag-container" });
    this.containerEl.addEventListener("touchstart", () => {
      this.lastInteractionWasTouch = true;
    }, { passive: true });
    this.containerEl.addEventListener("pointerdown", (e) => {
      if (e.pointerType && e.pointerType !== "touch")
        this.lastInteractionWasTouch = false;
    }, { passive: true });
    this.sortContainer = this.container.createDiv({ cls: "flat-tag-sort-container" });
    const buttonSection = this.sortContainer.createDiv({ cls: "flat-tag-buttons-section" });
    this.sortAzBtn = buttonSection.createDiv({ cls: "flat-tag-sort-button", title: "Sort A-Z" });
    (0, import_obsidian.setIcon)(this.sortAzBtn, "lucide-sort-asc");
    this.sortCountBtn = buttonSection.createDiv({ cls: "flat-tag-sort-button", title: "Sort by usage" });
    (0, import_obsidian.setIcon)(this.sortCountBtn, "lucide-bar-chart-2");
    const clearButton = buttonSection.createDiv({ cls: "flat-tag-clear-button", title: "Clear tag selections" });
    (0, import_obsidian.setIcon)(clearButton, "x");
    clearButton.addEventListener("click", () => {
      this.clearTagSelections();
    });
    this.scopeBtn = buttonSection.createDiv({
      cls: "flat-tag-mode-button",
      text: "NOTE",
      title: "Click to cycle: Note -> Line"
    });
    this.taskBtn = buttonSection.createDiv({
      cls: "flat-tag-mode-button",
      text: "TASK-ALL",
      title: "Click to cycle: All -> Todo -> Done"
    });
    const cutoffSpacer = buttonSection.createDiv({ cls: "flat-tag-cutoff-spacer" });
    cutoffSpacer.ariaHidden = "true";
    const cutoffSection = buttonSection.createDiv({ cls: "flat-tag-cutoff-section" });
    this.cutoffToggleBtn = cutoffSection.createDiv({ cls: "flat-tag-cutoff-toggle", title: "Toggle frequency cutoff" });
    this.cutoffToggleBtn.addEventListener("click", async () => {
      if (!this.plugin.settings)
        return;
      this.plugin.settings.frequencyCutoffEnabled = !this.plugin.settings.frequencyCutoffEnabled;
      await this.plugin.saveSettings();
      this.syncCutoffControlsFromSettings();
      this.renderTags();
    });
    this.cutoffInput = cutoffSection.createEl("input", {
      cls: "flat-tag-cutoff-input",
      attr: { type: "number", min: "0", step: "1", inputmode: "numeric", placeholder: "0" }
    });
    this.cutoffInput.addEventListener("input", async () => {
      if (!this.plugin.settings)
        return;
      const parsed = parseInt(this.cutoffInput.value, 10);
      if (!isNaN(parsed) && parsed >= 0) {
        this.plugin.settings.frequencyCutoff = parsed;
        await this.plugin.saveSettings();
        this.renderTags();
      }
    });
    this.syncCutoffControlsFromSettings();
    this.sortAzBtn.addEventListener("click", () => {
      this.currentSort = "az";
      this.updateModeUI(true);
    });
    this.sortCountBtn.addEventListener("click", () => {
      this.currentSort = "count";
      this.updateModeUI(true);
    });
    this.scopeBtn.addEventListener("click", () => this.toggleScopeMode());
    this.taskBtn.addEventListener("click", () => this.toggleTaskMode());
    this.updateModeUI(true);
    const searchSection = this.sortContainer.createDiv({ cls: "flat-tag-search-section" });
    const searchBox = searchSection.createEl("input", {
      cls: "flat-tag-search-input",
      attr: { type: "text", placeholder: "Search tags..." }
    });
    const clearSearchButton = searchSection.createDiv({ cls: "flat-tag-search-clear-button", title: "Clear search" });
    (0, import_obsidian.setIcon)(clearSearchButton, "square-x");
    clearSearchButton.addEventListener("click", () => {
      this.clearSearchBox();
    });
    searchBox.addEventListener("input", (e) => {
      const target = e.target;
      this.tagSearchText = target.value;
      this.renderTags();
    });
    this.tagContainer = this.container.createDiv({ cls: "flat-tag-list" });
    await this.loadTags();
    this.registerEvent(this.app.metadataCache.on("changed", (file) => {
      this.updateFileTags(file);
    }));
    this.registerEvent(this.app.vault.on("delete", (file) => {
      if (file instanceof import_obsidian.TFile && file.extension === "md") {
        this.removeFileTags(file.path);
        this.renderTags();
      }
    }));
    this.registerEvent(this.app.vault.on("rename", (file, oldPath) => {
      if (file instanceof import_obsidian.TFile && file.extension === "md") {
        const tags = this.tagsByFile.get(oldPath);
        if (tags) {
          this.tagsByFile.set(file.path, tags);
          this.tagsByFile.delete(oldPath);
        }
      }
    }));
    this.registerEvent(this.app.workspace.on("flat-tag-view:settings-updated", () => {
      this.syncCutoffControlsFromSettings();
      this.renderTags();
    }));
  }
  async loadTags() {
    this.allTags.clear();
    this.tagsByFile.clear();
    const files = this.app.vault.getMarkdownFiles();
    for (const file of files) {
      const fileTags = this.getFileTags(file);
      this.tagsByFile.set(file.path, fileTags);
      fileTags.forEach((tag) => {
        this.allTags.set(tag, (this.allTags.get(tag) || 0) + 1);
      });
    }
    this.renderTags();
  }
  updateFileTags(file) {
    const oldTagsArr = this.tagsByFile.get(file.path) || [];
    const newTagsArr = this.getFileTags(file);
    const oldSorted = [...oldTagsArr].sort().join(",");
    const newSorted = [...newTagsArr].sort().join(",");
    if (oldSorted !== newSorted) {
      oldTagsArr.forEach((tag) => {
        const count = (this.allTags.get(tag) || 0) - 1;
        if (count <= 0)
          this.allTags.delete(tag);
        else
          this.allTags.set(tag, count);
      });
      newTagsArr.forEach((tag) => {
        this.allTags.set(tag, (this.allTags.get(tag) || 0) + 1);
      });
      this.tagsByFile.set(file.path, newTagsArr);
      this.renderTags();
    }
  }
  removeFileTags(filePath) {
    const oldTags = this.tagsByFile.get(filePath);
    if (!oldTags)
      return;
    oldTags.forEach((tag) => {
      const count = (this.allTags.get(tag) || 0) - 1;
      if (count <= 0)
        this.allTags.delete(tag);
      else
        this.allTags.set(tag, count);
    });
    this.tagsByFile.delete(filePath);
  }
  async renderTags() {
    var _a;
    this.tagContainer.empty();
    if (this.sortContainer) {
      const sortAzBtn = this.sortContainer.querySelector('.flat-tag-sort-button[title="Sort A-Z"]');
      const sortCountBtn = this.sortContainer.querySelector('.flat-tag-sort-button[title="Sort by usage"]');
      if (sortAzBtn && sortCountBtn) {
        sortAzBtn.removeClass("is-active");
        sortCountBtn.removeClass("is-active");
        if (this.currentSort === "az")
          sortAzBtn.addClass("is-active");
        else
          sortCountBtn.addClass("is-active");
      }
    }
    const filteredTags = await this.getFilteredTagsAsync();
    const pinnedTags = /* @__PURE__ */ new Map();
    const normalTags = /* @__PURE__ */ new Map();
    const safePinnedList = ((_a = this.plugin.settings) == null ? void 0 : _a.pinnedTags) || [];
    const pinnedSet = new Set(safePinnedList);
    filteredTags.forEach((count, tag) => {
      if (pinnedSet.has(tag))
        pinnedTags.set(tag, count);
      else
        normalTags.set(tag, count);
    });
    if (pinnedTags.size > 0) {
      const pinContainer = this.tagContainer.createDiv({ cls: "flat-tag-pinned-section" });
      const pinnedIcon = pinContainer.createSpan({ cls: "flat-tag-letter" });
      (0, import_obsidian.setIcon)(pinnedIcon, "pin");
      const pinnedSorted = Array.from(pinnedTags.entries()).sort((a, b) => a[0].localeCompare(b[0], "pl"));
      pinnedSorted.forEach(([tag, count]) => {
        this.createTagElement(tag, count, pinContainer);
      });
      this.tagContainer.createDiv({ cls: "flat-tag-separator" });
    }
    let sortedTags;
    if (this.currentSort === "az") {
      sortedTags = Array.from(normalTags.entries()).sort((a, b) => a[0].localeCompare(b[0], "pl"));
    } else {
      sortedTags = Array.from(normalTags.entries()).sort((a, b) => {
        if (b[1] !== a[1])
          return b[1] - a[1];
        return a[0].localeCompare(b[0], "pl");
      });
    }
    if (this.currentSort === "az") {
      const tagsByLetter = /* @__PURE__ */ new Map();
      tagsByLetter.set("other", []);
      for (let charCode = 65; charCode <= 90; charCode++) {
        tagsByLetter.set(String.fromCharCode(charCode), []);
      }
      const polishDiacritics = ["\u0104", "\u0106", "\u0118", "\u0141", "\u0143", "\xD3", "\u015A", "\u0179", "\u017B"];
      polishDiacritics.forEach((letter) => tagsByLetter.set(letter, []));
      sortedTags.forEach((tagItem) => {
        var _a2, _b, _c;
        const [tag] = tagItem;
        const firstChar = tag.charAt(0).toUpperCase();
        if (firstChar.match(/[A-Z]/)) {
          (_a2 = tagsByLetter.get(firstChar)) == null ? void 0 : _a2.push(tagItem);
        } else if (polishDiacritics.includes(firstChar)) {
          (_b = tagsByLetter.get(firstChar)) == null ? void 0 : _b.push(tagItem);
        } else {
          (_c = tagsByLetter.get("other")) == null ? void 0 : _c.push(tagItem);
        }
      });
      tagsByLetter.forEach((letterTags, letter) => {
        if (letterTags.length > 0) {
          if (letter !== "other") {
            const letterEl = this.tagContainer.createSpan({ cls: "flat-tag-letter" });
            letterEl.setText(letter);
          }
          letterTags.forEach(([tag, count]) => {
            this.createTagElement(tag, count, this.tagContainer);
          });
        }
      });
    } else {
      sortedTags.forEach(([tag, count]) => {
        this.createTagElement(tag, count, this.tagContainer);
      });
    }
  }
  createTagElement(tag, count, parentEl) {
    var _a;
    const tagEl = parentEl.createSpan({ cls: "flat-tag" });
    if (this.selectedTags.has(tag))
      tagEl.addClass("flat-tag-selected");
    else if (this.excludedTags.has(tag))
      tagEl.addClass("flat-tag-excluded");
    const safePinned = ((_a = this.plugin.settings) == null ? void 0 : _a.pinnedTags) || [];
    if (safePinned.includes(tag))
      tagEl.addClass("flat-tag-pinned");
    tagEl.setText(`#${tag} (${count})`);
    tagEl.style.userSelect = "none";
    tagEl.style.webkitUserSelect = "none";
    const handleTagInteraction = async (isMultiSelect, isExclude, isPin) => {
      if (isPin) {
        if (!this.plugin.settings)
          return;
        if (!this.plugin.settings.pinnedTags)
          this.plugin.settings.pinnedTags = [];
        if (this.plugin.settings.pinnedTags.includes(tag)) {
          this.plugin.settings.pinnedTags = this.plugin.settings.pinnedTags.filter((t) => t !== tag);
        } else {
          this.plugin.settings.pinnedTags.push(tag);
        }
        await this.plugin.saveSettings();
        return;
      }
      if (isExclude) {
        if (this.excludedTags.has(tag)) {
          this.excludedTags.delete(tag);
        } else {
          this.excludedTags.add(tag);
          this.selectedTags.delete(tag);
        }
      } else if (isMultiSelect) {
        if (this.selectedTags.has(tag)) {
          this.selectedTags.delete(tag);
        } else {
          this.selectedTags.add(tag);
          this.excludedTags.delete(tag);
        }
      } else {
        if (this.selectedTags.size === 1 && this.selectedTags.has(tag)) {
          this.selectedTags.clear();
        } else {
          this.selectedTags.clear();
          this.excludedTags.clear();
          this.selectedTags.add(tag);
        }
      }
      this.renderTags();
      void this.updateSearch();
    };
    tagEl.addEventListener("click", (e) => {
      e.preventDefault();
      handleTagInteraction(e.ctrlKey || e.metaKey, e.shiftKey, e.altKey);
    });
    let touchStartX = 0;
    let touchStartY = 0;
    let isSwiping = false;
    tagEl.addEventListener("touchstart", (e) => {
      const touch = e.touches[0];
      touchStartX = touch.clientX;
      touchStartY = touch.clientY;
      isSwiping = false;
      this.touchTimer = window.setTimeout(() => {
        this.touchTimer = null;
        if (!isSwiping) {
          handleTagInteraction(true, false, false);
        }
      }, 500);
    }, { passive: true });
    tagEl.addEventListener("touchmove", (e) => {
      const touch = e.touches[0];
      const deltaX = touch.clientX - touchStartX;
      const deltaY = touch.clientY - touchStartY;
      if (!isSwiping) {
        if (Math.abs(deltaX) > 10 && Math.abs(deltaX) > Math.abs(deltaY)) {
          if (this.touchTimer) {
            window.clearTimeout(this.touchTimer);
            this.touchTimer = null;
          }
          isSwiping = true;
        } else if (Math.abs(deltaY) > 10) {
          if (this.touchTimer) {
            window.clearTimeout(this.touchTimer);
            this.touchTimer = null;
          }
          return;
        }
      }
      if (isSwiping && deltaX < 0) {
        e.preventDefault();
        const capped = Math.max(deltaX, -90);
        tagEl.style.transform = `translateX(${capped}px)`;
        tagEl.style.opacity = String(0.5 + Math.abs(capped) / 90 * 0.5);
      }
    }, { passive: false });
    tagEl.addEventListener("touchend", (e) => {
      const touch = e.changedTouches[0];
      const deltaX = touch.clientX - touchStartX;
      tagEl.style.transition = "transform 0.2s ease, opacity 0.2s ease";
      tagEl.style.transform = "";
      tagEl.style.opacity = "";
      setTimeout(() => {
        tagEl.style.transition = "";
      }, 220);
      if (isSwiping) {
        isSwiping = false;
        if (deltaX <= -60)
          handleTagInteraction(false, false, true);
        return;
      }
      if (this.touchTimer) {
        window.clearTimeout(this.touchTimer);
        this.touchTimer = null;
        handleTagInteraction(false, false, false);
      }
    }, { passive: true });
    tagEl.addEventListener("touchcancel", () => {
      isSwiping = false;
      if (this.touchTimer) {
        window.clearTimeout(this.touchTimer);
        this.touchTimer = null;
      }
      tagEl.style.transition = "transform 0.2s ease, opacity 0.2s ease";
      tagEl.style.transform = "";
      tagEl.style.opacity = "";
      setTimeout(() => {
        tagEl.style.transition = "";
      }, 220);
    }, { passive: true });
  }
  async getFilteredTagsAsync() {
    var _a, _b, _c, _d;
    let filteredTags = /* @__PURE__ */ new Map();
    if (this.selectedTags.size === 0) {
      filteredTags = new Map(this.allTags);
    } else {
      const selectedTagsArray = Array.from(this.selectedTags);
      const matchingFiles = [];
      this.tagsByFile.forEach((tagsArr, filePath) => {
        if (selectedTagsArray.every((tag) => tagsArr.includes(tag))) {
          matchingFiles.push(filePath);
        }
      });
      if (this.searchMode === "note") {
        matchingFiles.forEach((filePath) => {
          const fileTags = this.tagsByFile.get(filePath);
          if (fileTags) {
            fileTags.forEach((tag) => {
              filteredTags.set(tag, (filteredTags.get(tag) || 0) + 1);
            });
          }
        });
      } else {
        for (const filePath of matchingFiles) {
          const file = this.app.vault.getAbstractFileByPath(filePath);
          if (file instanceof import_obsidian.TFile) {
            const content = await this.app.vault.cachedRead(file);
            const lines = content.split("\n");
            for (const line of lines) {
              const lowerLine = line.toLowerCase();
              if (this.searchMode === "task" && !lowerLine.includes("- ["))
                continue;
              if (this.searchMode === "task-todo" && !lowerLine.includes("- [ ]"))
                continue;
              if (this.searchMode === "task-done" && !lowerLine.includes("- [x]"))
                continue;
              const lineTags = /* @__PURE__ */ new Set();
              const tagRegex = /#([^\s#]+)/g;
              let match;
              while ((match = tagRegex.exec(line)) !== null) {
                lineTags.add(match[1]);
              }
              if (selectedTagsArray.every((selectedTag) => {
                return Array.from(lineTags).some((t) => t.toLowerCase() === selectedTag.toLowerCase());
              })) {
                lineTags.forEach((tag) => {
                  filteredTags.set(tag, (filteredTags.get(tag) || 0) + 1);
                });
              }
            }
          }
        }
      }
      selectedTagsArray.forEach((tag) => {
        if (!filteredTags.has(tag)) {
          filteredTags.set(tag, this.allTags.get(tag) || 0);
        }
      });
    }
    Array.from(this.excludedTags).forEach((tag) => {
      if (!filteredTags.has(tag)) {
        filteredTags.set(tag, this.allTags.get(tag) || 0);
      }
    });
    const cutoffEnabled = (_b = (_a = this.plugin.settings) == null ? void 0 : _a.frequencyCutoffEnabled) != null ? _b : false;
    const cutoff = cutoffEnabled ? ((_c = this.plugin.settings) == null ? void 0 : _c.frequencyCutoff) || 0 : 0;
    const safePinned = ((_d = this.plugin.settings) == null ? void 0 : _d.pinnedTags) || [];
    if (cutoff > 0) {
      const result = /* @__PURE__ */ new Map();
      filteredTags.forEach((count, tag) => {
        if (count >= cutoff || this.selectedTags.has(tag) || safePinned.includes(tag)) {
          result.set(tag, count);
        }
      });
      filteredTags = result;
    }
    if (this.tagSearchText) {
      const searchText = this.tagSearchText.toLowerCase();
      const result = /* @__PURE__ */ new Map();
      filteredTags.forEach((count, tag) => {
        if (tag.toLowerCase().includes(searchText) || this.selectedTags.has(tag) || this.excludedTags.has(tag)) {
          result.set(tag, count);
        }
      });
      return result;
    }
    return filteredTags;
  }
  async updateSearch(options) {
    var _a, _b;
    const workspace = this.app.workspace;
    const prevLeaf = workspace.activeLeaf;
    const isTouchContext = import_obsidian.Platform.isMobile || this.lastInteractionWasTouch;
    const revealSearch = (_a = options == null ? void 0 : options.revealSearch) != null ? _a : !isTouchContext;
    const createIfMissing = (_b = options == null ? void 0 : options.createIfMissing) != null ? _b : !isTouchContext;
    let searchLeaf = workspace.getLeavesOfType("search")[0];
    if (!searchLeaf && createIfMissing) {
      const rightLeaf = workspace.getRightLeaf(true);
      if (rightLeaf) {
        searchLeaf = rightLeaf;
        await searchLeaf.setViewState({ type: "search", active: false });
      }
    }
    if (searchLeaf && revealSearch) {
      workspace.revealLeaf(searchLeaf);
    }
    if (prevLeaf) {
      workspace.setActiveLeaf(prevLeaf, { focus: true });
    }
    this.lastInteractionWasTouch = false;
    if (!searchLeaf)
      return;
    if (this.selectedTags.size === 0 && this.excludedTags.size === 0) {
      const searchView2 = searchLeaf.view;
      if (searchView2) {
        const clearBtn = searchView2.containerEl.querySelector(".search-input-clear-button");
        if (clearBtn) {
          clearBtn.dispatchEvent(new MouseEvent("click", { bubbles: true, cancelable: false }));
        } else if (typeof searchView2.setQuery === "function") {
          searchView2.setQuery("");
        }
      }
      return;
    }
    let tagQuery = "";
    const selected = Array.from(this.selectedTags);
    const excluded = Array.from(this.excludedTags);
    if (this.searchMode === "note") {
      tagQuery = [
        ...selected.map((tag) => `tag:#${tag}`),
        ...excluded.map((tag) => `-tag:#${tag}`)
      ].join(" ");
    } else {
      let prefix = "line:(";
      if (this.searchMode === "task")
        prefix = "task:(";
      else if (this.searchMode === "task-todo")
        prefix = "task-todo:(";
      else if (this.searchMode === "task-done")
        prefix = "task-done:(";
      const blockContents = [
        ...selected.map((tag) => `#${tag}`),
        ...excluded.map((tag) => `-#${tag}`)
      ].join(" ");
      tagQuery = `${prefix} ${blockContents} )`;
    }
    const searchView = searchLeaf.view;
    if (searchView && typeof searchView.setQuery === "function") {
      searchView.setQuery(tagQuery);
    }
  }
  getFileTags(file) {
    const cache = this.app.metadataCache.getFileCache(file);
    if (!cache)
      return [];
    const tags = [];
    if (cache.tags) {
      cache.tags.forEach((tagObj) => {
        tags.push(tagObj.tag.replace(/^#/, ""));
      });
    }
    if (cache.frontmatter && cache.frontmatter.tags) {
      const fmTags = cache.frontmatter.tags;
      if (typeof fmTags === "string") {
        fmTags.split(/[\s,]+/).filter(Boolean).forEach((tag) => {
          tags.push(tag);
        });
      } else if (Array.isArray(fmTags)) {
        fmTags.forEach((tag) => {
          if (tag)
            tags.push(String(tag));
        });
      }
    }
    return tags;
  }
  syncCutoffControlsFromSettings() {
    var _a, _b, _c, _d;
    if (!this.cutoffToggleBtn || !this.cutoffInput)
      return;
    const enabled = (_b = (_a = this.plugin.settings) == null ? void 0 : _a.frequencyCutoffEnabled) != null ? _b : false;
    const cutoff = (_d = (_c = this.plugin.settings) == null ? void 0 : _c.frequencyCutoff) != null ? _d : 0;
    this.cutoffInput.value = String(cutoff);
    this.cutoffInput.disabled = !enabled;
    this.cutoffToggleBtn.removeClass("is-enabled");
    this.cutoffToggleBtn.removeClass("is-disabled");
    if (enabled) {
      this.cutoffToggleBtn.addClass("is-enabled");
      (0, import_obsidian.setIcon)(this.cutoffToggleBtn, "eye");
    } else {
      this.cutoffToggleBtn.addClass("is-disabled");
      (0, import_obsidian.setIcon)(this.cutoffToggleBtn, "eye-off");
    }
  }
  updateModeUI(skipSearch = false) {
    if (!this.sortAzBtn || !this.sortCountBtn || !this.scopeBtn || !this.taskBtn)
      return;
    this.sortAzBtn.removeClass("is-active");
    this.sortCountBtn.removeClass("is-active");
    if (this.currentSort === "az")
      this.sortAzBtn.addClass("is-active");
    if (this.currentSort === "count")
      this.sortCountBtn.addClass("is-active");
    this.scopeBtn.removeClass("is-active");
    this.taskBtn.removeClass("is-active");
    if (this.searchMode === "note") {
      this.scopeBtn.setText("NOTE");
      this.scopeBtn.addClass("is-active");
    } else if (this.searchMode === "line") {
      this.scopeBtn.setText("LINE");
      this.scopeBtn.addClass("is-active");
    } else if (this.searchMode === "task") {
      this.taskBtn.setText("TASK-ALL");
      this.taskBtn.addClass("is-active");
    } else if (this.searchMode === "task-todo") {
      this.taskBtn.setText("TASK-TODO");
      this.taskBtn.addClass("is-active");
    } else if (this.searchMode === "task-done") {
      this.taskBtn.setText("TASK-DONE");
      this.taskBtn.addClass("is-active");
    }
    if (["note", "line"].includes(this.searchMode)) {
      if (!["TASK-ALL", "TASK-TODO", "TASK-DONE"].includes(this.taskBtn.innerText)) {
        this.taskBtn.setText("TASK-ALL");
      }
    } else {
      if (!["NOTE", "LINE"].includes(this.scopeBtn.innerText)) {
        this.scopeBtn.setText("NOTE");
      }
    }
    if (!skipSearch) {
      void this.updateSearch();
    }
    if (this.tagContainer) {
      this.renderTags();
    }
  }
  toggleScopeMode() {
    if (!this.scopeBtn)
      return;
    if (["note", "line"].includes(this.searchMode)) {
      this.searchMode = this.searchMode === "note" ? "line" : "note";
    } else {
      this.searchMode = this.scopeBtn.innerText === "LINE" ? "line" : "note";
    }
    this.updateModeUI();
  }
  toggleTaskMode() {
    if (!this.taskBtn)
      return;
    if (["task", "task-todo", "task-done"].includes(this.searchMode)) {
      if (this.searchMode === "task")
        this.searchMode = "task-todo";
      else if (this.searchMode === "task-todo")
        this.searchMode = "task-done";
      else
        this.searchMode = "task";
    } else {
      if (this.taskBtn.innerText === "TASK-TODO")
        this.searchMode = "task-todo";
      else if (this.taskBtn.innerText === "TASK-DONE")
        this.searchMode = "task-done";
      else
        this.searchMode = "task";
    }
    this.updateModeUI();
  }
  toggleSort() {
    this.currentSort = this.currentSort === "az" ? "count" : "az";
    this.updateModeUI(true);
  }
  clearTagSelections() {
    this.selectedTags.clear();
    this.excludedTags.clear();
    this.renderTags();
    void this.updateSearch({ revealSearch: false, createIfMissing: false });
  }
  clearSearchBox() {
    const searchBox = this.contentEl.querySelector(".flat-tag-search-input");
    if (searchBox) {
      searchBox.value = "";
      this.tagSearchText = "";
      this.renderTags();
    }
  }
};

// styles.ts
var getStyles = () => {
  return `
    .workspace-split.mod-root .view-content.flat-tag-view {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: stretch;
      height: 100%;
      padding: 0;
      margin: 0;
    }

    .flat-tag-container {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }

    .flat-tag-sort-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
      padding: 8px;
      background-color: var(--background-primary);
      border-bottom: 1px solid var(--background-modifier-border);
      width: 100%;
      flex-wrap: wrap;
      gap: 8px;
    }

    .flat-tag-buttons-section {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    .flat-tag-mode-button {
      cursor: pointer;
      padding: 4px 10px;
      font-size: 0.8em;
      font-weight: 500;
      border-radius: var(--radius-s);
      color: var(--text-muted);
      background-color: var(--background-modifier-form-field);
      border: 1px solid var(--background-modifier-border);
      transition: all 0.15s ease-in-out;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 65px;
    }

    .flat-tag-mode-button:hover {
      color: var(--text-normal);
      background-color: var(--background-modifier-hover);
      border-color: var(--background-modifier-border-hover);
    }

    .flat-tag-mode-button.is-active {
      background-color: var(--interactive-accent);
      color: var(--text-on-accent);
      border-color: var(--interactive-accent);
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .flat-tag-mode-button.is-active:hover {
      background-color: var(--interactive-accent-hover);
      border-color: var(--interactive-accent-hover);
    }

    .flat-tag-search-section {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-left: auto;
      background-color: var(--background-secondary);
      border-radius: 4px;
      padding: 2px 8px;
      flex-grow: 1;
      max-width: 200px;
    }

    .flat-tag-search-input {
      background: transparent;
      border: none;
      color: var(--text-normal);
      width: 100%;
      height: 24px;
      font-size: 0.9em;
    }

    .flat-tag-search-input:focus {
      outline: none;
      box-shadow: none;
    }

    .flat-tag-search-clear-button {
      cursor: pointer;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8em;
    }

    .flat-tag-search-clear-button:hover {
      color: var(--text-normal);
    }

    .flat-tag-sort-button, .flat-tag-clear-button {
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .flat-tag-sort-button:hover, .flat-tag-clear-button:hover {
      background-color: var(--interactive-hover);
    }

    .flat-tag-sort-button.is-active {
      background-color: var(--interactive-accent);
      color: var(--text-on-accent);
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .flat-tag-sort-button.is-active:hover {
      background-color: var(--interactive-accent-hover);
    }

    /* Cutoff controls (lives inside .flat-tag-buttons-section) */
    .flat-tag-cutoff-spacer {
      flex: 0 0 8px;
      width: 8px;
      height: 1px;
    }

    .flat-tag-cutoff-section {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 2px 8px;
      border-radius: var(--radius-s);
      border: 1px solid var(--background-modifier-border);
      background: linear-gradient(180deg, var(--background-secondary) 0%, var(--background-primary) 100%);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
      height: 28px;
    }

    .flat-tag-cutoff-toggle {
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      padding: 2px;
      border-radius: var(--radius-s);
    }

    .flat-tag-cutoff-toggle:hover {
      color: var(--text-normal);
      background-color: var(--background-modifier-hover);
    }

    .flat-tag-cutoff-toggle.is-enabled {
      color: var(--interactive-accent);
    }

    .flat-tag-cutoff-toggle.is-disabled {
      opacity: 0.7;
    }

    .flat-tag-cutoff-input {
      width: 44px;
      height: 22px;
      border: none;
      background: transparent;
      padding: 0;
      margin: 0;
      text-align: center;
      font-size: 0.9em;
      color: var(--text-normal);
    }

    .flat-tag-cutoff-input:focus {
      outline: none;
      box-shadow: none;
    }

    .flat-tag-cutoff-input:disabled {
      color: var(--text-faint);
      cursor: not-allowed;
    }

    .flat-tag-list {
      display: flex;
      flex-wrap: wrap;
      align-content: flex-start;
      overflow-y: auto;
      flex: 1;
      line-height: 1.5em;
      padding: 8px;
      width: 100%;
    }

    .flat-tag {
      display: inline-block;
      padding: 2px 6px;
      margin: 2px;
      border-radius: 4px;
      cursor: pointer;
      background-color: var(--tag-background);
      color: var(--tag-color);
      transition: background-color 0.1s;
    }

    .flat-tag:hover {
      background-color: var(--tag-background-hover);
    }

    .flat-tag-selected {
      font-weight: bold;
      background-color: var(--interactive-accent);
      color: var(--text-on-accent);
    }

    .flat-tag-excluded {
      font-weight: bold;
      background-color: var(--color-red);
      color: var(--text-on-accent);
    }

    .flat-tag-letter {
      display: inline-flex;
      font-weight: bold;
      font-size: 1.2em;
      margin: 2px;
      padding: 2px 6px;
      border-radius: 4px;
      background-color: var(--background-secondary);
      color: var(--text-normal);
      align-items: center;
      justify-content: center;
      min-width: 24px;
    }

    .flat-tag-pinned-section {
      width: 100%;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      background-color: color-mix(in srgb, var(--interactive-accent) 10%, var(--background-primary));
      border: 1px solid color-mix(in srgb, var(--interactive-accent) 25%, transparent);
      padding: 4px;
      border-radius: var(--radius-s);
      margin-bottom: 4px;
    }

    .flat-tag-separator {
      width: 100%;
      height: 1px;
      background-color: var(--background-modifier-border);
      margin: 4px 0 8px 0;
    }

    .flat-tag-pinned {
      border: 1px solid var(--interactive-accent);
    }
  `;
};

// settings.ts
var import_obsidian2 = require("obsidian");
var DEFAULT_SETTINGS = {
  pinnedTags: [],
  frequencyCutoff: 0,
  // 0 means show all tags
  frequencyCutoffEnabled: false,
  altClickTagMode: "start-line"
};
var FlatTagSettingTab = class extends import_obsidian2.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian2.Setting(containerEl).setName("Alt-click creates tag").setDesc(
      "When you Alt-click in the editor, create a tag from the current selection (or the word at cursor) using the chosen mode."
    ).addDropdown(
      (dd) => dd.addOption("start-line", "Put tag at start of line").addOption("in-place", "Turn word into tag in place").addOption("end-line", "Put tag at end of line").setValue(this.plugin.settings.altClickTagMode).onChange(async (value) => {
        this.plugin.settings.altClickTagMode = value;
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian2.Setting(containerEl).setName("Frequency cutoff").setDesc("Hide tags that appear fewer times than this number in the vault.").addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.frequencyCutoffEnabled).onChange(async (value) => {
        this.plugin.settings.frequencyCutoffEnabled = value;
        await this.plugin.saveSettings();
      })
    ).addText(
      (text) => text.setPlaceholder("0").setValue(this.plugin.settings.frequencyCutoff.toString()).onChange(async (value) => {
        const parsed = parseInt(value, 10);
        if (!isNaN(parsed) && parsed >= 0) {
          this.plugin.settings.frequencyCutoff = parsed;
          await this.plugin.saveSettings();
        }
      })
    );
    new import_obsidian2.Setting(containerEl).setName("Clear pinned tags").setDesc("Removes all pinned tags from the top of the flat tag list.").addButton(
      (btn) => btn.setButtonText("Clear pinned").onClick(async () => {
        this.plugin.settings.pinnedTags = [];
        await this.plugin.saveSettings();
      })
    );
  }
};

// main.ts
var FlatTagPlugin = class extends import_obsidian3.Plugin {
  async onload() {
    await this.loadSettings();
    this.registerView(VIEW_TYPE, (leaf) => new FlatTagView(leaf, this));
    this.addRibbonIcon("tag", "Open Flat Tags", () => {
      this.activateView();
    });
    this.addSettingTab(new FlatTagSettingTab(this.app, this));
    this.addCommand({
      id: "open-flat-tags",
      name: "Open Flat Tags",
      callback: () => this.activateView()
    });
    this.addCommand({
      id: "toggle-flat-tag-sort",
      name: "Toggle Flat Tag Sort (A-Z/Usage)",
      callback: () => {
        var _a;
        const view = (_a = this.app.workspace.getLeavesOfType(VIEW_TYPE)[0]) == null ? void 0 : _a.view;
        if (view && typeof view.toggleSort === "function")
          view.toggleSort();
      }
    });
    this.addCommand({
      id: "clear-flat-tag-selections",
      name: "Clear Flat Tag Selections",
      callback: () => {
        var _a;
        const view = (_a = this.app.workspace.getLeavesOfType(VIEW_TYPE)[0]) == null ? void 0 : _a.view;
        if (view && typeof view.clearTagSelections === "function")
          view.clearTagSelections();
      }
    });
    this.addCommand({
      id: "clear-flat-tag-search",
      name: "Clear Flat Tag Search Box",
      callback: () => {
        var _a;
        const view = (_a = this.app.workspace.getLeavesOfType(VIEW_TYPE)[0]) == null ? void 0 : _a.view;
        if (view && typeof view.clearSearchBox === "function")
          view.clearSearchBox();
      }
    });
    this.addCommand({
      id: "toggle-flat-tag-scope-mode",
      name: "Toggle Flat Tag Mode (Note/Line)",
      callback: () => {
        var _a;
        const view = (_a = this.app.workspace.getLeavesOfType(VIEW_TYPE)[0]) == null ? void 0 : _a.view;
        if (view && typeof view.toggleScopeMode === "function")
          view.toggleScopeMode();
      }
    });
    this.addCommand({
      id: "toggle-flat-tag-task-mode",
      name: "Cycle Flat Tag Task Mode (All/Todo/Done)",
      callback: () => {
        var _a;
        const view = (_a = this.app.workspace.getLeavesOfType(VIEW_TYPE)[0]) == null ? void 0 : _a.view;
        if (view && typeof view.toggleTaskMode === "function")
          view.toggleTaskMode();
      }
    });
    this.addStyle();
    this.registerDomEvent(document, "click", (evt) => {
      if (!evt.altKey)
        return;
      void this.handleEditorAltClick(evt);
    });
  }
  async handleEditorAltClick(evt) {
    const view = this.app.workspace.getActiveViewOfType(import_obsidian3.MarkdownView);
    if (!view)
      return;
    const anyView = view;
    if (typeof anyView.getMode === "function" && anyView.getMode() !== "source")
      return;
    const target = evt.target;
    if (!target || !view.containerEl.contains(target))
      return;
    const editor = view.editor;
    if (!editor)
      return;
    const candidate = this.getTagCandidate(editor);
    if (!candidate)
      return;
    await this.applyAltClickTagMode(editor, this.settings.altClickTagMode, candidate);
  }
  getTagCandidate(editor) {
    var _a;
    const sel = editor.getSelection();
    if (sel && sel.trim() && !/\r|\n/.test(sel)) {
      return { text: sel.trim() };
    }
    const cursor = editor.getCursor();
    const wordAt = (_a = editor.wordAt) == null ? void 0 : _a.call(editor, cursor);
    if (!wordAt)
      return null;
    const word = editor.getRange(wordAt.from, wordAt.to);
    if (!word || !word.trim())
      return null;
    return { text: word.trim(), range: { from: wordAt.from, to: wordAt.to } };
  }
  normalizeTagText(raw) {
    let t = raw.trim();
    if (!t)
      return null;
    t = t.replace(/^#+/, "");
    t = t.replace(/^[\s\.,;:!\?\)\]\}\"\']+/, "").replace(/[\s\.,;:!\?\(\[\{\"']+$/, "");
    if (!t)
      return null;
    if (/\s/.test(t))
      return null;
    if (t.includes("#"))
      return null;
    return t;
  }
  async applyAltClickTagMode(editor, mode, candidate) {
    const normalized = this.normalizeTagText(candidate.text);
    if (!normalized)
      return;
    const tagToken = `#${normalized}`;
    if (mode === "in-place") {
      if (editor.getSelection() && editor.getSelection().trim()) {
        editor.replaceSelection(tagToken);
        return;
      }
      if (candidate.range) {
        editor.replaceRange(tagToken, candidate.range.from, candidate.range.to);
      }
      return;
    }
    const line = editor.getCursor().line;
    const lineText = editor.getLine(line);
    if (mode === "start-line") {
      const { indent, tags, after } = this.parseLeadingTags(lineText);
      if (tags.includes(tagToken))
        return;
      const nextTags = [...tags, tagToken].sort((a, b) => a.localeCompare(b, "pl"));
      const prefix = nextTags.length ? nextTags.join(" ") + (after.length ? " " : "") : "";
      editor.replaceRange(indent + prefix + after, { line, ch: 0 }, { line, ch: lineText.length });
      return;
    }
    if (mode === "end-line") {
      const { before, tags, trailingWs } = this.parseTrailingTags(lineText);
      if (tags.includes(tagToken))
        return;
      const nextTags = [...tags, tagToken].sort((a, b) => a.localeCompare(b, "pl"));
      const joiner = before.length ? " " : "";
      const suffix = nextTags.length ? joiner + nextTags.join(" ") : "";
      editor.replaceRange(before + suffix + trailingWs, { line, ch: 0 }, { line, ch: lineText.length });
      return;
    }
  }
  parseLeadingTags(lineText) {
    var _a, _b, _c;
    const indent = ((_a = lineText.match(/^\s*/)) != null ? _a : [""])[0];
    const rest = lineText.slice(indent.length);
    const m = rest.match(/^((?:#[^\s#]+\s+)*)/);
    const tagBlock = (_b = m == null ? void 0 : m[1]) != null ? _b : "";
    const tags = (_c = tagBlock.match(/#[^\s#]+/g)) != null ? _c : [];
    const after = rest.slice(tagBlock.length);
    return { indent, tags, after };
  }
  parseTrailingTags(lineText) {
    var _a;
    const trimmedEnd = lineText.replace(/\s+$/, "");
    const trailingWs = lineText.slice(trimmedEnd.length);
    const m = trimmedEnd.match(/(\s+(?:#[^\s#]+\s*)+)$/);
    if (!m)
      return { before: trimmedEnd, tags: [], trailingWs };
    const tagBlock = m[1];
    const tags = (_a = tagBlock.match(/#[^\s#]+/g)) != null ? _a : [];
    const before = trimmedEnd.slice(0, trimmedEnd.length - tagBlock.length);
    return { before, tags, trailingWs };
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
    this.app.workspace.trigger("flat-tag-view:settings-updated");
  }
  async onunload() {
    this.app.workspace.detachLeavesOfType(VIEW_TYPE);
  }
  async activateView() {
    const { workspace } = this.app;
    let leaf = workspace.getLeavesOfType(VIEW_TYPE)[0];
    if (!leaf) {
      const rightLeaf = workspace.getRightLeaf(false);
      if (rightLeaf) {
        leaf = rightLeaf;
        await leaf.setViewState({ type: VIEW_TYPE });
      }
    }
    if (leaf)
      workspace.revealLeaf(leaf);
  }
  addStyle() {
    const styleEl = document.createElement("style");
    styleEl.innerHTML = getStyles();
    document.head.appendChild(styleEl);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJmbGF0VGFnVmlldy50cyIsICJjb25zdGFudHMudHMiLCAic3R5bGVzLnRzIiwgInNldHRpbmdzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBQbHVnaW4sIFdvcmtzcGFjZUxlYWYsIE1hcmtkb3duVmlldywgRWRpdG9yLCBFZGl0b3JQb3NpdGlvbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgRmxhdFRhZ1ZpZXcgfSBmcm9tIFwiLi9mbGF0VGFnVmlld1wiO1xuaW1wb3J0IHsgVklFV19UWVBFIH0gZnJvbSBcIi4vY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBnZXRTdHlsZXMgfSBmcm9tIFwiLi9zdHlsZXNcIjtcbmltcG9ydCB7XG4gIEZsYXRUYWdQbHVnaW5TZXR0aW5ncyxcbiAgREVGQVVMVF9TRVRUSU5HUyxcbiAgRmxhdFRhZ1NldHRpbmdUYWIsXG4gIEFsdENsaWNrVGFnTW9kZSxcbn0gZnJvbSBcIi4vc2V0dGluZ3NcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRmxhdFRhZ1BsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG4gIHNldHRpbmdzOiBGbGF0VGFnUGx1Z2luU2V0dGluZ3M7XG5cbiAgYXN5bmMgb25sb2FkKCkge1xuICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG5cbiAgICB0aGlzLnJlZ2lzdGVyVmlldyhWSUVXX1RZUEUsIChsZWFmOiBXb3Jrc3BhY2VMZWFmKSA9PiBuZXcgRmxhdFRhZ1ZpZXcobGVhZiwgdGhpcykpO1xuXG4gICAgdGhpcy5hZGRSaWJib25JY29uKFwidGFnXCIsIFwiT3BlbiBGbGF0IFRhZ3NcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5hY3RpdmF0ZVZpZXcoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgRmxhdFRhZ1NldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcblxuICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJvcGVuLWZsYXQtdGFnc1wiLFxuICAgICAgbmFtZTogXCJPcGVuIEZsYXQgVGFnc1wiLFxuICAgICAgY2FsbGJhY2s6ICgpID0+IHRoaXMuYWN0aXZhdGVWaWV3KCksXG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwidG9nZ2xlLWZsYXQtdGFnLXNvcnRcIixcbiAgICAgIG5hbWU6IFwiVG9nZ2xlIEZsYXQgVGFnIFNvcnQgKEEtWi9Vc2FnZSlcIixcbiAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhdmVzT2ZUeXBlKFZJRVdfVFlQRSlbMF0/LnZpZXcgYXMgRmxhdFRhZ1ZpZXc7XG4gICAgICAgIGlmICh2aWV3ICYmIHR5cGVvZiB2aWV3LnRvZ2dsZVNvcnQgPT09IFwiZnVuY3Rpb25cIikgdmlldy50b2dnbGVTb3J0KCk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcImNsZWFyLWZsYXQtdGFnLXNlbGVjdGlvbnNcIixcbiAgICAgIG5hbWU6IFwiQ2xlYXIgRmxhdCBUYWcgU2VsZWN0aW9uc1wiLFxuICAgICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgY29uc3QgdmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoVklFV19UWVBFKVswXT8udmlldyBhcyBGbGF0VGFnVmlldztcbiAgICAgICAgaWYgKHZpZXcgJiYgdHlwZW9mIHZpZXcuY2xlYXJUYWdTZWxlY3Rpb25zID09PSBcImZ1bmN0aW9uXCIpIHZpZXcuY2xlYXJUYWdTZWxlY3Rpb25zKCk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcImNsZWFyLWZsYXQtdGFnLXNlYXJjaFwiLFxuICAgICAgbmFtZTogXCJDbGVhciBGbGF0IFRhZyBTZWFyY2ggQm94XCIsXG4gICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICBjb25zdCB2aWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZShWSUVXX1RZUEUpWzBdPy52aWV3IGFzIEZsYXRUYWdWaWV3O1xuICAgICAgICBpZiAodmlldyAmJiB0eXBlb2Ygdmlldy5jbGVhclNlYXJjaEJveCA9PT0gXCJmdW5jdGlvblwiKSB2aWV3LmNsZWFyU2VhcmNoQm94KCk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcInRvZ2dsZS1mbGF0LXRhZy1zY29wZS1tb2RlXCIsXG4gICAgICBuYW1lOiBcIlRvZ2dsZSBGbGF0IFRhZyBNb2RlIChOb3RlL0xpbmUpXCIsXG4gICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICBjb25zdCB2aWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZShWSUVXX1RZUEUpWzBdPy52aWV3IGFzIEZsYXRUYWdWaWV3O1xuICAgICAgICBpZiAodmlldyAmJiB0eXBlb2Ygdmlldy50b2dnbGVTY29wZU1vZGUgPT09IFwiZnVuY3Rpb25cIikgdmlldy50b2dnbGVTY29wZU1vZGUoKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwidG9nZ2xlLWZsYXQtdGFnLXRhc2stbW9kZVwiLFxuICAgICAgbmFtZTogXCJDeWNsZSBGbGF0IFRhZyBUYXNrIE1vZGUgKEFsbC9Ub2RvL0RvbmUpXCIsXG4gICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICBjb25zdCB2aWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZShWSUVXX1RZUEUpWzBdPy52aWV3IGFzIEZsYXRUYWdWaWV3O1xuICAgICAgICBpZiAodmlldyAmJiB0eXBlb2Ygdmlldy50b2dnbGVUYXNrTW9kZSA9PT0gXCJmdW5jdGlvblwiKSB2aWV3LnRvZ2dsZVRhc2tNb2RlKCk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRTdHlsZSgpO1xuXG4gICAgLy8gQWx0LWNsaWNrIGluIGVkaXRvciA9PiBjcmVhdGUgdGFnIGZyb20gc2VsZWN0aW9uL3dvcmRcbiAgICB0aGlzLnJlZ2lzdGVyRG9tRXZlbnQoZG9jdW1lbnQsIFwiY2xpY2tcIiwgKGV2dDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgaWYgKCFldnQuYWx0S2V5KSByZXR1cm47XG4gICAgICB2b2lkIHRoaXMuaGFuZGxlRWRpdG9yQWx0Q2xpY2soZXZ0KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlRWRpdG9yQWx0Q2xpY2soZXZ0OiBNb3VzZUV2ZW50KSB7XG4gICAgY29uc3QgdmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG4gICAgaWYgKCF2aWV3KSByZXR1cm47XG5cbiAgICAvLyBPbmx5IGluIHNvdXJjZS9lZGl0b3IgbW9kZSAoYXZvaWQgcHJldmlldylcbiAgICBjb25zdCBhbnlWaWV3ID0gdmlldyBhcyBhbnk7XG4gICAgaWYgKHR5cGVvZiBhbnlWaWV3LmdldE1vZGUgPT09IFwiZnVuY3Rpb25cIiAmJiBhbnlWaWV3LmdldE1vZGUoKSAhPT0gXCJzb3VyY2VcIikgcmV0dXJuO1xuXG4gICAgY29uc3QgdGFyZ2V0ID0gZXZ0LnRhcmdldCBhcyBOb2RlIHwgbnVsbDtcbiAgICBpZiAoIXRhcmdldCB8fCAhdmlldy5jb250YWluZXJFbC5jb250YWlucyh0YXJnZXQpKSByZXR1cm47XG5cbiAgICBjb25zdCBlZGl0b3IgPSB2aWV3LmVkaXRvcjtcbiAgICBpZiAoIWVkaXRvcikgcmV0dXJuO1xuXG4gICAgY29uc3QgY2FuZGlkYXRlID0gdGhpcy5nZXRUYWdDYW5kaWRhdGUoZWRpdG9yKTtcbiAgICBpZiAoIWNhbmRpZGF0ZSkgcmV0dXJuO1xuXG4gICAgYXdhaXQgdGhpcy5hcHBseUFsdENsaWNrVGFnTW9kZShlZGl0b3IsIHRoaXMuc2V0dGluZ3MuYWx0Q2xpY2tUYWdNb2RlLCBjYW5kaWRhdGUpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUYWdDYW5kaWRhdGUoXG4gICAgZWRpdG9yOiBFZGl0b3JcbiAgKTogeyB0ZXh0OiBzdHJpbmc7IHJhbmdlPzogeyBmcm9tOiBFZGl0b3JQb3NpdGlvbjsgdG86IEVkaXRvclBvc2l0aW9uIH0gfSB8IG51bGwge1xuICAgIGNvbnN0IHNlbCA9IGVkaXRvci5nZXRTZWxlY3Rpb24oKTtcbiAgICBpZiAoc2VsICYmIHNlbC50cmltKCkgJiYgIS9cXHJ8XFxuLy50ZXN0KHNlbCkpIHtcbiAgICAgIHJldHVybiB7IHRleHQ6IHNlbC50cmltKCkgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJzb3IgPSBlZGl0b3IuZ2V0Q3Vyc29yKCk7XG4gICAgY29uc3Qgd29yZEF0ID0gKGVkaXRvciBhcyBhbnkpLndvcmRBdD8uKGN1cnNvcik7XG4gICAgaWYgKCF3b3JkQXQpIHJldHVybiBudWxsO1xuXG4gICAgY29uc3Qgd29yZCA9IGVkaXRvci5nZXRSYW5nZSh3b3JkQXQuZnJvbSwgd29yZEF0LnRvKTtcbiAgICBpZiAoIXdvcmQgfHwgIXdvcmQudHJpbSgpKSByZXR1cm4gbnVsbDtcblxuICAgIHJldHVybiB7IHRleHQ6IHdvcmQudHJpbSgpLCByYW5nZTogeyBmcm9tOiB3b3JkQXQuZnJvbSwgdG86IHdvcmRBdC50byB9IH07XG4gIH1cblxuICBwcml2YXRlIG5vcm1hbGl6ZVRhZ1RleHQocmF3OiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcbiAgICBsZXQgdCA9IHJhdy50cmltKCk7XG4gICAgaWYgKCF0KSByZXR1cm4gbnVsbDtcblxuICAgIC8vIFN0cmlwIGxlYWRpbmcgJyMnXG4gICAgdCA9IHQucmVwbGFjZSgvXiMrLywgXCJcIik7XG5cbiAgICAvLyBUcmltIGNvbW1vbiBzdXJyb3VuZGluZyBwdW5jdHVhdGlvblxuICAgIHQgPSB0XG4gICAgICAucmVwbGFjZSgvXltcXHNcXC4sOzohXFw/XFwpXFxdXFx9XFxcIlxcJ10rLywgXCJcIilcbiAgICAgIC5yZXBsYWNlKC9bXFxzXFwuLDs6IVxcP1xcKFxcW1xce1xcXCInXSskLywgXCJcIik7XG4gICAgaWYgKCF0KSByZXR1cm4gbnVsbDtcblxuICAgIC8vIERpc2FsbG93IHdoaXRlc3BhY2Ugb3IgaW50ZXJuYWwgJyMnXG4gICAgaWYgKC9cXHMvLnRlc3QodCkpIHJldHVybiBudWxsO1xuICAgIGlmICh0LmluY2x1ZGVzKFwiI1wiKSkgcmV0dXJuIG51bGw7XG5cbiAgICByZXR1cm4gdDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgYXBwbHlBbHRDbGlja1RhZ01vZGUoXG4gICAgZWRpdG9yOiBFZGl0b3IsXG4gICAgbW9kZTogQWx0Q2xpY2tUYWdNb2RlLFxuICAgIGNhbmRpZGF0ZTogeyB0ZXh0OiBzdHJpbmc7IHJhbmdlPzogeyBmcm9tOiBFZGl0b3JQb3NpdGlvbjsgdG86IEVkaXRvclBvc2l0aW9uIH0gfVxuICApIHtcbiAgICBjb25zdCBub3JtYWxpemVkID0gdGhpcy5ub3JtYWxpemVUYWdUZXh0KGNhbmRpZGF0ZS50ZXh0KTtcbiAgICBpZiAoIW5vcm1hbGl6ZWQpIHJldHVybjtcblxuICAgIGNvbnN0IHRhZ1Rva2VuID0gYCMke25vcm1hbGl6ZWR9YDtcblxuICAgIGlmIChtb2RlID09PSBcImluLXBsYWNlXCIpIHtcbiAgICAgIGlmIChlZGl0b3IuZ2V0U2VsZWN0aW9uKCkgJiYgZWRpdG9yLmdldFNlbGVjdGlvbigpLnRyaW0oKSkge1xuICAgICAgICBlZGl0b3IucmVwbGFjZVNlbGVjdGlvbih0YWdUb2tlbik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChjYW5kaWRhdGUucmFuZ2UpIHtcbiAgICAgICAgZWRpdG9yLnJlcGxhY2VSYW5nZSh0YWdUb2tlbiwgY2FuZGlkYXRlLnJhbmdlLmZyb20sIGNhbmRpZGF0ZS5yYW5nZS50byk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgbGluZSA9IGVkaXRvci5nZXRDdXJzb3IoKS5saW5lO1xuICAgIGNvbnN0IGxpbmVUZXh0ID0gZWRpdG9yLmdldExpbmUobGluZSk7XG5cbiAgICBpZiAobW9kZSA9PT0gXCJzdGFydC1saW5lXCIpIHtcbiAgICAgIGNvbnN0IHsgaW5kZW50LCB0YWdzLCBhZnRlciB9ID0gdGhpcy5wYXJzZUxlYWRpbmdUYWdzKGxpbmVUZXh0KTtcbiAgICAgIGlmICh0YWdzLmluY2x1ZGVzKHRhZ1Rva2VuKSkgcmV0dXJuO1xuXG4gICAgICBjb25zdCBuZXh0VGFncyA9IFsuLi50YWdzLCB0YWdUb2tlbl0uc29ydCgoYSwgYikgPT4gYS5sb2NhbGVDb21wYXJlKGIsIFwicGxcIikpO1xuICAgICAgY29uc3QgcHJlZml4ID0gbmV4dFRhZ3MubGVuZ3RoID8gbmV4dFRhZ3Muam9pbihcIiBcIikgKyAoYWZ0ZXIubGVuZ3RoID8gXCIgXCIgOiBcIlwiKSA6IFwiXCI7XG5cbiAgICAgIGVkaXRvci5yZXBsYWNlUmFuZ2UoaW5kZW50ICsgcHJlZml4ICsgYWZ0ZXIsIHsgbGluZSwgY2g6IDAgfSwgeyBsaW5lLCBjaDogbGluZVRleHQubGVuZ3RoIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChtb2RlID09PSBcImVuZC1saW5lXCIpIHtcbiAgICAgIGNvbnN0IHsgYmVmb3JlLCB0YWdzLCB0cmFpbGluZ1dzIH0gPSB0aGlzLnBhcnNlVHJhaWxpbmdUYWdzKGxpbmVUZXh0KTtcbiAgICAgIGlmICh0YWdzLmluY2x1ZGVzKHRhZ1Rva2VuKSkgcmV0dXJuO1xuXG4gICAgICBjb25zdCBuZXh0VGFncyA9IFsuLi50YWdzLCB0YWdUb2tlbl0uc29ydCgoYSwgYikgPT4gYS5sb2NhbGVDb21wYXJlKGIsIFwicGxcIikpO1xuICAgICAgY29uc3Qgam9pbmVyID0gYmVmb3JlLmxlbmd0aCA/IFwiIFwiIDogXCJcIjtcbiAgICAgIGNvbnN0IHN1ZmZpeCA9IG5leHRUYWdzLmxlbmd0aCA/IGpvaW5lciArIG5leHRUYWdzLmpvaW4oXCIgXCIpIDogXCJcIjtcblxuICAgICAgZWRpdG9yLnJlcGxhY2VSYW5nZShiZWZvcmUgKyBzdWZmaXggKyB0cmFpbGluZ1dzLCB7IGxpbmUsIGNoOiAwIH0sIHsgbGluZSwgY2g6IGxpbmVUZXh0Lmxlbmd0aCB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHBhcnNlTGVhZGluZ1RhZ3MobGluZVRleHQ6IHN0cmluZyk6IHsgaW5kZW50OiBzdHJpbmc7IHRhZ3M6IHN0cmluZ1tdOyBhZnRlcjogc3RyaW5nIH0ge1xuICAgIGNvbnN0IGluZGVudCA9IChsaW5lVGV4dC5tYXRjaCgvXlxccyovKSA/PyBbXCJcIl0pWzBdO1xuICAgIGNvbnN0IHJlc3QgPSBsaW5lVGV4dC5zbGljZShpbmRlbnQubGVuZ3RoKTtcblxuICAgIGNvbnN0IG0gPSByZXN0Lm1hdGNoKC9eKCg/OiNbXlxccyNdK1xccyspKikvKTtcbiAgICBjb25zdCB0YWdCbG9jayA9IG0/LlsxXSA/PyBcIlwiO1xuICAgIGNvbnN0IHRhZ3MgPSB0YWdCbG9jay5tYXRjaCgvI1teXFxzI10rL2cpID8/IFtdO1xuICAgIGNvbnN0IGFmdGVyID0gcmVzdC5zbGljZSh0YWdCbG9jay5sZW5ndGgpO1xuXG4gICAgcmV0dXJuIHsgaW5kZW50LCB0YWdzLCBhZnRlciB9O1xuICB9XG5cbiAgcHJpdmF0ZSBwYXJzZVRyYWlsaW5nVGFncyhsaW5lVGV4dDogc3RyaW5nKTogeyBiZWZvcmU6IHN0cmluZzsgdGFnczogc3RyaW5nW107IHRyYWlsaW5nV3M6IHN0cmluZyB9IHtcbiAgICBjb25zdCB0cmltbWVkRW5kID0gbGluZVRleHQucmVwbGFjZSgvXFxzKyQvLCBcIlwiKTtcbiAgICBjb25zdCB0cmFpbGluZ1dzID0gbGluZVRleHQuc2xpY2UodHJpbW1lZEVuZC5sZW5ndGgpO1xuXG4gICAgY29uc3QgbSA9IHRyaW1tZWRFbmQubWF0Y2goLyhcXHMrKD86I1teXFxzI10rXFxzKikrKSQvKTtcbiAgICBpZiAoIW0pIHJldHVybiB7IGJlZm9yZTogdHJpbW1lZEVuZCwgdGFnczogW10sIHRyYWlsaW5nV3MgfTtcblxuICAgIGNvbnN0IHRhZ0Jsb2NrID0gbVsxXTtcbiAgICBjb25zdCB0YWdzID0gdGFnQmxvY2subWF0Y2goLyNbXlxccyNdKy9nKSA/PyBbXTtcbiAgICBjb25zdCBiZWZvcmUgPSB0cmltbWVkRW5kLnNsaWNlKDAsIHRyaW1tZWRFbmQubGVuZ3RoIC0gdGFnQmxvY2subGVuZ3RoKTtcblxuICAgIHJldHVybiB7IGJlZm9yZSwgdGFncywgdHJhaWxpbmdXcyB9O1xuICB9XG5cbiAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuICB9XG5cbiAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG4gICAgdGhpcy5hcHAud29ya3NwYWNlLnRyaWdnZXIoXCJmbGF0LXRhZy12aWV3OnNldHRpbmdzLXVwZGF0ZWRcIik7XG4gIH1cblxuICBhc3luYyBvbnVubG9hZCgpIHtcbiAgICB0aGlzLmFwcC53b3Jrc3BhY2UuZGV0YWNoTGVhdmVzT2ZUeXBlKFZJRVdfVFlQRSk7XG4gIH1cblxuICBhc3luYyBhY3RpdmF0ZVZpZXcoKSB7XG4gICAgY29uc3QgeyB3b3Jrc3BhY2UgfSA9IHRoaXMuYXBwO1xuXG4gICAgbGV0IGxlYWYgPSB3b3Jrc3BhY2UuZ2V0TGVhdmVzT2ZUeXBlKFZJRVdfVFlQRSlbMF07XG4gICAgaWYgKCFsZWFmKSB7XG4gICAgICBjb25zdCByaWdodExlYWYgPSB3b3Jrc3BhY2UuZ2V0UmlnaHRMZWFmKGZhbHNlKTtcbiAgICAgIGlmIChyaWdodExlYWYpIHtcbiAgICAgICAgbGVhZiA9IHJpZ2h0TGVhZjtcbiAgICAgICAgYXdhaXQgbGVhZi5zZXRWaWV3U3RhdGUoeyB0eXBlOiBWSUVXX1RZUEUgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGxlYWYpIHdvcmtzcGFjZS5yZXZlYWxMZWFmKGxlYWYpO1xuICB9XG5cbiAgYWRkU3R5bGUoKSB7XG4gICAgY29uc3Qgc3R5bGVFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzdHlsZVwiKTtcbiAgICBzdHlsZUVsLmlubmVySFRNTCA9IGdldFN0eWxlcygpO1xuICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGVFbCk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBJdGVtVmlldywgV29ya3NwYWNlTGVhZiwgVEZpbGUsIHNldEljb24sIFBsYXRmb3JtIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBWSUVXX1RZUEUgfSBmcm9tIFwiLi9jb25zdGFudHNcIjtcbmltcG9ydCBGbGF0VGFnUGx1Z2luIGZyb20gXCIuL21haW5cIjtcblxuZXhwb3J0IGNsYXNzIEZsYXRUYWdWaWV3IGV4dGVuZHMgSXRlbVZpZXcge1xuXG4gICAgcHVibGljIHBsdWdpbjogRmxhdFRhZ1BsdWdpbjtcbiAgICBwcml2YXRlIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gICAgcHJpdmF0ZSB0YWdDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICAgIHByaXZhdGUgc29ydENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gICAgcHJpdmF0ZSBzb3J0QXpCdG46IEhUTUxFbGVtZW50O1xuICAgIHByaXZhdGUgc29ydENvdW50QnRuOiBIVE1MRWxlbWVudDtcbiAgICBwcml2YXRlIHNjb3BlQnRuOiBIVE1MRWxlbWVudDtcbiAgICBwcml2YXRlIHRhc2tCdG46IEhUTUxFbGVtZW50O1xuXG4gICAgcHJpdmF0ZSBjdXRvZmZUb2dnbGVCdG46IEhUTUxFbGVtZW50O1xuICAgIHByaXZhdGUgY3V0b2ZmSW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG5cbiAgICBwcml2YXRlIHNlbGVjdGVkVGFnczogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XG4gICAgcHJpdmF0ZSBleGNsdWRlZFRhZ3M6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xuICAgIHByaXZhdGUgYWxsVGFnczogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTtcbiAgICBwcml2YXRlIGN1cnJlbnRTb3J0OiBcImF6XCIgfCBcImNvdW50XCIgPSBcImF6XCI7XG5cbiAgICBwcml2YXRlIHRhZ3NCeUZpbGU6IE1hcDxzdHJpbmcsIHN0cmluZ1tdPiA9IG5ldyBNYXAoKTtcbiAgICBwcml2YXRlIHRhZ1NlYXJjaFRleHQ6IHN0cmluZyA9IFwiXCI7XG4gICAgcHJpdmF0ZSBzZWFyY2hNb2RlOiBcIm5vdGVcIiB8IFwibGluZVwiIHwgXCJ0YXNrXCIgfCBcInRhc2stdG9kb1wiIHwgXCJ0YXNrLWRvbmVcIiA9IFwibm90ZVwiO1xuXG4gICAgcHJpdmF0ZSB0b3VjaFRpbWVyOiBudW1iZXIgfCBudWxsID0gbnVsbDtcbiAgICBwcml2YXRlIGxhc3RJbnRlcmFjdGlvbldhc1RvdWNoOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3RvcihsZWFmOiBXb3Jrc3BhY2VMZWFmLCBwbHVnaW46IEZsYXRUYWdQbHVnaW4pIHtcbiAgICAgICAgc3VwZXIobGVhZik7XG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgICAgICB0aGlzLmNvbnRhaW5lckVsLmFkZENsYXNzKFwiZmxhdC10YWctdmlld1wiKTtcbiAgICB9XG5cbiAgICBnZXRWaWV3VHlwZSgpOiBzdHJpbmcgeyByZXR1cm4gVklFV19UWVBFOyB9XG4gICAgZ2V0RGlzcGxheVRleHQoKTogc3RyaW5nIHsgcmV0dXJuIFwiRmxhdCBUYWdzXCI7IH1cbiAgICBnZXRJY29uKCk6IHN0cmluZyB7IHJldHVybiBcInRhZ1wiOyB9XG5cbiAgICBhc3luYyBvbk9wZW4oKSB7XG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcImZsYXQtdGFnLWNvbnRhaW5lclwiIH0pO1xuXG4gICAgICAgIHRoaXMuY29udGFpbmVyRWwuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5sYXN0SW50ZXJhY3Rpb25XYXNUb3VjaCA9IHRydWU7XG4gICAgICAgIH0sIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcbiAgICAgICAgdGhpcy5jb250YWluZXJFbC5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcmRvd25cIiwgKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChlLnBvaW50ZXJUeXBlICYmIGUucG9pbnRlclR5cGUgIT09IFwidG91Y2hcIikgdGhpcy5sYXN0SW50ZXJhY3Rpb25XYXNUb3VjaCA9IGZhbHNlO1xuICAgICAgICB9LCB7IHBhc3NpdmU6IHRydWUgfSk7XG5cbiAgICAgICAgdGhpcy5zb3J0Q29udGFpbmVyID0gdGhpcy5jb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiBcImZsYXQtdGFnLXNvcnQtY29udGFpbmVyXCIgfSk7XG4gICAgICAgIGNvbnN0IGJ1dHRvblNlY3Rpb24gPSB0aGlzLnNvcnRDb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiBcImZsYXQtdGFnLWJ1dHRvbnMtc2VjdGlvblwiIH0pO1xuXG4gICAgICAgIHRoaXMuc29ydEF6QnRuID0gYnV0dG9uU2VjdGlvbi5jcmVhdGVEaXYoeyBjbHM6IFwiZmxhdC10YWctc29ydC1idXR0b25cIiwgdGl0bGU6IFwiU29ydCBBLVpcIiB9KTtcbiAgICAgICAgc2V0SWNvbih0aGlzLnNvcnRBekJ0biwgXCJsdWNpZGUtc29ydC1hc2NcIik7XG4gICAgICAgIHRoaXMuc29ydENvdW50QnRuID0gYnV0dG9uU2VjdGlvbi5jcmVhdGVEaXYoeyBjbHM6IFwiZmxhdC10YWctc29ydC1idXR0b25cIiwgdGl0bGU6IFwiU29ydCBieSB1c2FnZVwiIH0pO1xuICAgICAgICBzZXRJY29uKHRoaXMuc29ydENvdW50QnRuLCBcImx1Y2lkZS1iYXItY2hhcnQtMlwiKTtcblxuICAgICAgICBjb25zdCBjbGVhckJ1dHRvbiA9IGJ1dHRvblNlY3Rpb24uY3JlYXRlRGl2KHsgY2xzOiBcImZsYXQtdGFnLWNsZWFyLWJ1dHRvblwiLCB0aXRsZTogXCJDbGVhciB0YWcgc2VsZWN0aW9uc1wiIH0pO1xuICAgICAgICBzZXRJY29uKGNsZWFyQnV0dG9uLCBcInhcIik7XG4gICAgICAgIGNsZWFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7IHRoaXMuY2xlYXJUYWdTZWxlY3Rpb25zKCk7IH0pO1xuXG4gICAgICAgIHRoaXMuc2NvcGVCdG4gPSBidXR0b25TZWN0aW9uLmNyZWF0ZURpdih7XG4gICAgICAgICAgICBjbHM6IFwiZmxhdC10YWctbW9kZS1idXR0b25cIiwgdGV4dDogXCJOT1RFXCIsIHRpdGxlOiBcIkNsaWNrIHRvIGN5Y2xlOiBOb3RlIC0+IExpbmVcIlxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50YXNrQnRuID0gYnV0dG9uU2VjdGlvbi5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgY2xzOiBcImZsYXQtdGFnLW1vZGUtYnV0dG9uXCIsIHRleHQ6IFwiVEFTSy1BTExcIiwgdGl0bGU6IFwiQ2xpY2sgdG8gY3ljbGU6IEFsbCAtPiBUb2RvIC0+IERvbmVcIlxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDdXRvZmYgVUkgKGJ1dHRvbiArIG51bWVyaWMgZmllbGQpIGxpdmVzIGJldHdlZW4gVEFTSyBhbmQgc2VhcmNoXG4gICAgICAgIGNvbnN0IGN1dG9mZlNwYWNlciA9IGJ1dHRvblNlY3Rpb24uY3JlYXRlRGl2KHsgY2xzOiBcImZsYXQtdGFnLWN1dG9mZi1zcGFjZXJcIiB9KTtcbiAgICAgICAgY3V0b2ZmU3BhY2VyLmFyaWFIaWRkZW4gPSBcInRydWVcIjtcblxuICAgICAgICBjb25zdCBjdXRvZmZTZWN0aW9uID0gYnV0dG9uU2VjdGlvbi5jcmVhdGVEaXYoeyBjbHM6IFwiZmxhdC10YWctY3V0b2ZmLXNlY3Rpb25cIiB9KTtcblxuICAgICAgICB0aGlzLmN1dG9mZlRvZ2dsZUJ0biA9IGN1dG9mZlNlY3Rpb24uY3JlYXRlRGl2KHsgY2xzOiBcImZsYXQtdGFnLWN1dG9mZi10b2dnbGVcIiwgdGl0bGU6IFwiVG9nZ2xlIGZyZXF1ZW5jeSBjdXRvZmZcIiB9KTtcbiAgICAgICAgdGhpcy5jdXRvZmZUb2dnbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3MpIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZyZXF1ZW5jeUN1dG9mZkVuYWJsZWQgPSAhdGhpcy5wbHVnaW4uc2V0dGluZ3MuZnJlcXVlbmN5Q3V0b2ZmRW5hYmxlZDtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgdGhpcy5zeW5jQ3V0b2ZmQ29udHJvbHNGcm9tU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyVGFncygpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmN1dG9mZklucHV0ID0gY3V0b2ZmU2VjdGlvbi5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgICAgICAgIGNsczogXCJmbGF0LXRhZy1jdXRvZmYtaW5wdXRcIixcbiAgICAgICAgICAgIGF0dHI6IHsgdHlwZTogXCJudW1iZXJcIiwgbWluOiBcIjBcIiwgc3RlcDogXCIxXCIsIGlucHV0bW9kZTogXCJudW1lcmljXCIsIHBsYWNlaG9sZGVyOiBcIjBcIiB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmN1dG9mZklucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzKSByZXR1cm47XG4gICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBwYXJzZUludCh0aGlzLmN1dG9mZklucHV0LnZhbHVlLCAxMCk7XG4gICAgICAgICAgICBpZiAoIWlzTmFOKHBhcnNlZCkgJiYgcGFyc2VkID49IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mcmVxdWVuY3lDdXRvZmYgPSBwYXJzZWQ7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJUYWdzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuc3luY0N1dG9mZkNvbnRyb2xzRnJvbVNldHRpbmdzKCk7XG5cbiAgICAgICAgdGhpcy5zb3J0QXpCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNvcnQgPSBcImF6XCI7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZU1vZGVVSSh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc29ydENvdW50QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTb3J0ID0gXCJjb3VudFwiO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVNb2RlVUkodHJ1ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuc2NvcGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMudG9nZ2xlU2NvcGVNb2RlKCkpO1xuICAgICAgICB0aGlzLnRhc2tCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMudG9nZ2xlVGFza01vZGUoKSk7XG5cbiAgICAgICAgdGhpcy51cGRhdGVNb2RlVUkodHJ1ZSk7XG5cbiAgICAgICAgY29uc3Qgc2VhcmNoU2VjdGlvbiA9IHRoaXMuc29ydENvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwiZmxhdC10YWctc2VhcmNoLXNlY3Rpb25cIiB9KTtcbiAgICAgICAgY29uc3Qgc2VhcmNoQm94ID0gc2VhcmNoU2VjdGlvbi5jcmVhdGVFbChcImlucHV0XCIsIHtcbiAgICAgICAgICAgIGNsczogXCJmbGF0LXRhZy1zZWFyY2gtaW5wdXRcIixcbiAgICAgICAgICAgIGF0dHI6IHsgdHlwZTogXCJ0ZXh0XCIsIHBsYWNlaG9sZGVyOiBcIlNlYXJjaCB0YWdzLi4uXCIgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgY2xlYXJTZWFyY2hCdXR0b24gPSBzZWFyY2hTZWN0aW9uLmNyZWF0ZURpdih7IGNsczogXCJmbGF0LXRhZy1zZWFyY2gtY2xlYXItYnV0dG9uXCIsIHRpdGxlOiBcIkNsZWFyIHNlYXJjaFwiIH0pO1xuICAgICAgICBzZXRJY29uKGNsZWFyU2VhcmNoQnV0dG9uLCBcInNxdWFyZS14XCIpO1xuICAgICAgICBjbGVhclNlYXJjaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4geyB0aGlzLmNsZWFyU2VhcmNoQm94KCk7IH0pO1xuXG4gICAgICAgIHNlYXJjaEJveC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLnRhZ1NlYXJjaFRleHQgPSB0YXJnZXQudmFsdWU7XG4gICAgICAgICAgICB0aGlzLnJlbmRlclRhZ3MoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy50YWdDb250YWluZXIgPSB0aGlzLmNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwiZmxhdC10YWctbGlzdFwiIH0pO1xuICAgICAgICBhd2FpdCB0aGlzLmxvYWRUYWdzKCk7XG5cbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUub24oXCJjaGFuZ2VkXCIsIChmaWxlOiBURmlsZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVGaWxlVGFncyhmaWxlKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQodGhpcy5hcHAudmF1bHQub24oXCJkZWxldGVcIiwgKGZpbGUpID0+IHtcbiAgICAgICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUgJiYgZmlsZS5leHRlbnNpb24gPT09IFwibWRcIikge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlRmlsZVRhZ3MoZmlsZS5wYXRoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlclRhZ3MoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQodGhpcy5hcHAudmF1bHQub24oXCJyZW5hbWVcIiwgKGZpbGUsIG9sZFBhdGgpID0+IHtcbiAgICAgICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUgJiYgZmlsZS5leHRlbnNpb24gPT09IFwibWRcIikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhZ3MgPSB0aGlzLnRhZ3NCeUZpbGUuZ2V0KG9sZFBhdGgpO1xuICAgICAgICAgICAgICAgIGlmICh0YWdzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGFnc0J5RmlsZS5zZXQoZmlsZS5wYXRoLCB0YWdzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50YWdzQnlGaWxlLmRlbGV0ZShvbGRQYXRoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImZsYXQtdGFnLXZpZXc6c2V0dGluZ3MtdXBkYXRlZFwiIGFzIGFueSwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zeW5jQ3V0b2ZmQ29udHJvbHNGcm9tU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyVGFncygpO1xuICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgYXN5bmMgbG9hZFRhZ3MoKSB7XG4gICAgICAgIHRoaXMuYWxsVGFncy5jbGVhcigpO1xuICAgICAgICB0aGlzLnRhZ3NCeUZpbGUuY2xlYXIoKTtcbiAgICAgICAgY29uc3QgZmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCk7XG4gICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykge1xuICAgICAgICAgICAgY29uc3QgZmlsZVRhZ3MgPSB0aGlzLmdldEZpbGVUYWdzKGZpbGUpO1xuICAgICAgICAgICAgdGhpcy50YWdzQnlGaWxlLnNldChmaWxlLnBhdGgsIGZpbGVUYWdzKTtcbiAgICAgICAgICAgIGZpbGVUYWdzLmZvckVhY2godGFnID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFsbFRhZ3Muc2V0KHRhZywgKHRoaXMuYWxsVGFncy5nZXQodGFnKSB8fCAwKSArIDEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZW5kZXJUYWdzKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVGaWxlVGFncyhmaWxlOiBURmlsZSkge1xuICAgICAgICBjb25zdCBvbGRUYWdzQXJyID0gdGhpcy50YWdzQnlGaWxlLmdldChmaWxlLnBhdGgpIHx8IFtdO1xuICAgICAgICBjb25zdCBuZXdUYWdzQXJyID0gdGhpcy5nZXRGaWxlVGFncyhmaWxlKTtcbiAgICAgICAgY29uc3Qgb2xkU29ydGVkID0gWy4uLm9sZFRhZ3NBcnJdLnNvcnQoKS5qb2luKFwiLFwiKTtcbiAgICAgICAgY29uc3QgbmV3U29ydGVkID0gWy4uLm5ld1RhZ3NBcnJdLnNvcnQoKS5qb2luKFwiLFwiKTtcbiAgICAgICAgaWYgKG9sZFNvcnRlZCAhPT0gbmV3U29ydGVkKSB7XG4gICAgICAgICAgICBvbGRUYWdzQXJyLmZvckVhY2godGFnID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9ICh0aGlzLmFsbFRhZ3MuZ2V0KHRhZykgfHwgMCkgLSAxO1xuICAgICAgICAgICAgICAgIGlmIChjb3VudCA8PSAwKSB0aGlzLmFsbFRhZ3MuZGVsZXRlKHRhZyk7XG4gICAgICAgICAgICAgICAgZWxzZSB0aGlzLmFsbFRhZ3Muc2V0KHRhZywgY291bnQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBuZXdUYWdzQXJyLmZvckVhY2godGFnID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFsbFRhZ3Muc2V0KHRhZywgKHRoaXMuYWxsVGFncy5nZXQodGFnKSB8fCAwKSArIDEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnRhZ3NCeUZpbGUuc2V0KGZpbGUucGF0aCwgbmV3VGFnc0Fycik7XG4gICAgICAgICAgICB0aGlzLnJlbmRlclRhZ3MoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgcmVtb3ZlRmlsZVRhZ3MoZmlsZVBhdGg6IHN0cmluZykge1xuICAgICAgICBjb25zdCBvbGRUYWdzID0gdGhpcy50YWdzQnlGaWxlLmdldChmaWxlUGF0aCk7XG4gICAgICAgIGlmICghb2xkVGFncykgcmV0dXJuO1xuICAgICAgICBvbGRUYWdzLmZvckVhY2godGFnID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gKHRoaXMuYWxsVGFncy5nZXQodGFnKSB8fCAwKSAtIDE7XG4gICAgICAgICAgICBpZiAoY291bnQgPD0gMCkgdGhpcy5hbGxUYWdzLmRlbGV0ZSh0YWcpO1xuICAgICAgICAgICAgZWxzZSB0aGlzLmFsbFRhZ3Muc2V0KHRhZywgY291bnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50YWdzQnlGaWxlLmRlbGV0ZShmaWxlUGF0aCk7XG4gICAgfVxuXG4gICAgYXN5bmMgcmVuZGVyVGFncygpIHtcbiAgICAgICAgdGhpcy50YWdDb250YWluZXIuZW1wdHkoKTtcbiAgICAgICAgaWYgKHRoaXMuc29ydENvbnRhaW5lcikge1xuICAgICAgICAgICAgY29uc3Qgc29ydEF6QnRuID0gdGhpcy5zb3J0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mbGF0LXRhZy1zb3J0LWJ1dHRvblt0aXRsZT1cIlNvcnQgQS1aXCJdJyk7XG4gICAgICAgICAgICBjb25zdCBzb3J0Q291bnRCdG4gPSB0aGlzLnNvcnRDb250YWluZXIucXVlcnlTZWxlY3RvcignLmZsYXQtdGFnLXNvcnQtYnV0dG9uW3RpdGxlPVwiU29ydCBieSB1c2FnZVwiXScpO1xuICAgICAgICAgICAgaWYgKHNvcnRBekJ0biAmJiBzb3J0Q291bnRCdG4pIHtcbiAgICAgICAgICAgICAgICBzb3J0QXpCdG4ucmVtb3ZlQ2xhc3MoJ2lzLWFjdGl2ZScpO1xuICAgICAgICAgICAgICAgIHNvcnRDb3VudEJ0bi5yZW1vdmVDbGFzcygnaXMtYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudFNvcnQgPT09ICdheicpIHNvcnRBekJ0bi5hZGRDbGFzcygnaXMtYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgZWxzZSBzb3J0Q291bnRCdG4uYWRkQ2xhc3MoJ2lzLWFjdGl2ZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZmlsdGVyZWRUYWdzID0gYXdhaXQgdGhpcy5nZXRGaWx0ZXJlZFRhZ3NBc3luYygpO1xuICAgICAgICBjb25zdCBwaW5uZWRUYWdzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgY29uc3Qgbm9ybWFsVGFncyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gICAgICAgIGNvbnN0IHNhZmVQaW5uZWRMaXN0ID0gdGhpcy5wbHVnaW4uc2V0dGluZ3M/LnBpbm5lZFRhZ3MgfHwgW107XG4gICAgICAgIGNvbnN0IHBpbm5lZFNldCA9IG5ldyBTZXQoc2FmZVBpbm5lZExpc3QpO1xuXG4gICAgICAgIGZpbHRlcmVkVGFncy5mb3JFYWNoKChjb3VudCwgdGFnKSA9PiB7XG4gICAgICAgICAgICBpZiAocGlubmVkU2V0Lmhhcyh0YWcpKSBwaW5uZWRUYWdzLnNldCh0YWcsIGNvdW50KTtcbiAgICAgICAgICAgIGVsc2Ugbm9ybWFsVGFncy5zZXQodGFnLCBjb3VudCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChwaW5uZWRUYWdzLnNpemUgPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBwaW5Db250YWluZXIgPSB0aGlzLnRhZ0NvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwiZmxhdC10YWctcGlubmVkLXNlY3Rpb25cIiB9KTtcbiAgICAgICAgICAgIGNvbnN0IHBpbm5lZEljb24gPSBwaW5Db250YWluZXIuY3JlYXRlU3Bhbih7IGNsczogXCJmbGF0LXRhZy1sZXR0ZXJcIiB9KTtcbiAgICAgICAgICAgIHNldEljb24ocGlubmVkSWNvbiwgXCJwaW5cIik7XG4gICAgICAgICAgICBjb25zdCBwaW5uZWRTb3J0ZWQgPSBBcnJheS5mcm9tKHBpbm5lZFRhZ3MuZW50cmllcygpKS5zb3J0KChhLCBiKSA9PiBhWzBdLmxvY2FsZUNvbXBhcmUoYlswXSwgJ3BsJykpO1xuICAgICAgICAgICAgcGlubmVkU29ydGVkLmZvckVhY2goKFt0YWcsIGNvdW50XSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlVGFnRWxlbWVudCh0YWcsIGNvdW50LCBwaW5Db250YWluZXIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnRhZ0NvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwiZmxhdC10YWctc2VwYXJhdG9yXCIgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgc29ydGVkVGFnczogW3N0cmluZywgbnVtYmVyXVtdO1xuXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRTb3J0ID09PSBcImF6XCIpIHtcbiAgICAgICAgICAgIHNvcnRlZFRhZ3MgPSBBcnJheS5mcm9tKG5vcm1hbFRhZ3MuZW50cmllcygpKS5zb3J0KChhLCBiKSA9PiBhWzBdLmxvY2FsZUNvbXBhcmUoYlswXSwgJ3BsJykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc29ydGVkVGFncyA9IEFycmF5LmZyb20obm9ybWFsVGFncy5lbnRyaWVzKCkpLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoYlsxXSAhPT0gYVsxXSkgcmV0dXJuIGJbMV0gLSBhWzFdO1xuICAgICAgICAgICAgICAgIHJldHVybiBhWzBdLmxvY2FsZUNvbXBhcmUoYlswXSwgJ3BsJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRTb3J0ID09PSBcImF6XCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHRhZ3NCeUxldHRlciA9IG5ldyBNYXA8c3RyaW5nLCBbc3RyaW5nLCBudW1iZXJdW10+KCk7XG4gICAgICAgICAgICB0YWdzQnlMZXR0ZXIuc2V0KFwib3RoZXJcIiwgW10pO1xuICAgICAgICAgICAgZm9yIChsZXQgY2hhckNvZGUgPSA2NTsgY2hhckNvZGUgPD0gOTA7IGNoYXJDb2RlKyspIHtcbiAgICAgICAgICAgICAgICB0YWdzQnlMZXR0ZXIuc2V0KFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpLCBbXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBwb2xpc2hEaWFjcml0aWNzID0gWydcdTAxMDQnLCAnXHUwMTA2JywgJ1x1MDExOCcsICdcdTAxNDEnLCAnXHUwMTQzJywgJ1x1MDBEMycsICdcdTAxNUEnLCAnXHUwMTc5JywgJ1x1MDE3QiddO1xuICAgICAgICAgICAgcG9saXNoRGlhY3JpdGljcy5mb3JFYWNoKGxldHRlciA9PiB0YWdzQnlMZXR0ZXIuc2V0KGxldHRlciwgW10pKTtcblxuICAgICAgICAgICAgc29ydGVkVGFncy5mb3JFYWNoKHRhZ0l0ZW0gPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IFt0YWddID0gdGFnSXRlbTtcbiAgICAgICAgICAgICAgICBjb25zdCBmaXJzdENoYXIgPSB0YWcuY2hhckF0KDApLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgaWYgKGZpcnN0Q2hhci5tYXRjaCgvW0EtWl0vKSkge1xuICAgICAgICAgICAgICAgICAgICB0YWdzQnlMZXR0ZXIuZ2V0KGZpcnN0Q2hhcik/LnB1c2godGFnSXRlbSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwb2xpc2hEaWFjcml0aWNzLmluY2x1ZGVzKGZpcnN0Q2hhcikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFnc0J5TGV0dGVyLmdldChmaXJzdENoYXIpPy5wdXNoKHRhZ0l0ZW0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRhZ3NCeUxldHRlci5nZXQoXCJvdGhlclwiKT8ucHVzaCh0YWdJdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGFnc0J5TGV0dGVyLmZvckVhY2goKGxldHRlclRhZ3MsIGxldHRlcikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChsZXR0ZXJUYWdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxldHRlciAhPT0gXCJvdGhlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsZXR0ZXJFbCA9IHRoaXMudGFnQ29udGFpbmVyLmNyZWF0ZVNwYW4oeyBjbHM6IFwiZmxhdC10YWctbGV0dGVyXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXR0ZXJFbC5zZXRUZXh0KGxldHRlcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbGV0dGVyVGFncy5mb3JFYWNoKChbdGFnLCBjb3VudF0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlVGFnRWxlbWVudCh0YWcsIGNvdW50LCB0aGlzLnRhZ0NvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc29ydGVkVGFncy5mb3JFYWNoKChbdGFnLCBjb3VudF0pID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVRhZ0VsZW1lbnQodGFnLCBjb3VudCwgdGhpcy50YWdDb250YWluZXIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGNyZWF0ZVRhZ0VsZW1lbnQodGFnOiBzdHJpbmcsIGNvdW50OiBudW1iZXIsIHBhcmVudEVsOiBIVE1MRWxlbWVudCkge1xuICAgICAgICBjb25zdCB0YWdFbCA9IHBhcmVudEVsLmNyZWF0ZVNwYW4oeyBjbHM6IFwiZmxhdC10YWdcIiB9KTtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRUYWdzLmhhcyh0YWcpKSB0YWdFbC5hZGRDbGFzcyhcImZsYXQtdGFnLXNlbGVjdGVkXCIpO1xuICAgICAgICBlbHNlIGlmICh0aGlzLmV4Y2x1ZGVkVGFncy5oYXModGFnKSkgdGFnRWwuYWRkQ2xhc3MoXCJmbGF0LXRhZy1leGNsdWRlZFwiKTtcbiAgICAgICAgY29uc3Qgc2FmZVBpbm5lZCA9IHRoaXMucGx1Z2luLnNldHRpbmdzPy5waW5uZWRUYWdzIHx8IFtdO1xuICAgICAgICBpZiAoc2FmZVBpbm5lZC5pbmNsdWRlcyh0YWcpKSB0YWdFbC5hZGRDbGFzcyhcImZsYXQtdGFnLXBpbm5lZFwiKTtcblxuICAgICAgICB0YWdFbC5zZXRUZXh0KGAjJHt0YWd9ICgke2NvdW50fSlgKTtcbiAgICAgICAgLy8gUHJvdmlkZSB1c2VyLXNlbGVjdCBub25lIHRvIHByZXZlbnQgbW9iaWxlIHNlbGVjdGlvbiBnbGl0Y2hlc1xuICAgICAgICB0YWdFbC5zdHlsZS51c2VyU2VsZWN0ID0gXCJub25lXCI7XG4gICAgICAgIHRhZ0VsLnN0eWxlLndlYmtpdFVzZXJTZWxlY3QgPSBcIm5vbmVcIjtcblxuICAgICAgICBjb25zdCBoYW5kbGVUYWdJbnRlcmFjdGlvbiA9IGFzeW5jIChpc011bHRpU2VsZWN0OiBib29sZWFuLCBpc0V4Y2x1ZGU6IGJvb2xlYW4sIGlzUGluOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNQaW4pIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzKSByZXR1cm47XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5waW5uZWRUYWdzKSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5waW5uZWRUYWdzID0gW107XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLnBpbm5lZFRhZ3MuaW5jbHVkZXModGFnKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5waW5uZWRUYWdzID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MucGlubmVkVGFncy5maWx0ZXIodCA9PiB0ICE9PSB0YWcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnBpbm5lZFRhZ3MucHVzaCh0YWcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpc0V4Y2x1ZGUpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5leGNsdWRlZFRhZ3MuaGFzKHRhZykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leGNsdWRlZFRhZ3MuZGVsZXRlKHRhZyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leGNsdWRlZFRhZ3MuYWRkKHRhZyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRUYWdzLmRlbGV0ZSh0YWcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNNdWx0aVNlbGVjdCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkVGFncy5oYXModGFnKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkVGFncy5kZWxldGUodGFnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkVGFncy5hZGQodGFnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leGNsdWRlZFRhZ3MuZGVsZXRlKHRhZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFRhZ3Muc2l6ZSA9PT0gMSAmJiB0aGlzLnNlbGVjdGVkVGFncy5oYXModGFnKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkVGFncy5jbGVhcigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRUYWdzLmNsZWFyKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXhjbHVkZWRUYWdzLmNsZWFyKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRUYWdzLmFkZCh0YWcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVuZGVyVGFncygpO1xuICAgICAgICAgICAgdm9pZCB0aGlzLnVwZGF0ZVNlYXJjaCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRhZ0VsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaGFuZGxlVGFnSW50ZXJhY3Rpb24oZS5jdHJsS2V5IHx8IGUubWV0YUtleSwgZS5zaGlmdEtleSwgZS5hbHRLZXkpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyAtLS0tIFRvdWNoOiBzd2lwZSBMRUZUID0gcGluL3VucGluIHwgbG9uZyBwcmVzcyA9IG11bHRpLXNlbGVjdCB8IHRhcCA9IHNlbGVjdCAtLS0tXG4gICAgICAgIGxldCB0b3VjaFN0YXJ0WCA9IDA7XG4gICAgICAgIGxldCB0b3VjaFN0YXJ0WSA9IDA7XG4gICAgICAgIGxldCBpc1N3aXBpbmcgPSBmYWxzZTtcblxuICAgICAgICB0YWdFbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdG91Y2ggPSBlLnRvdWNoZXNbMF07XG4gICAgICAgICAgICB0b3VjaFN0YXJ0WCA9IHRvdWNoLmNsaWVudFg7XG4gICAgICAgICAgICB0b3VjaFN0YXJ0WSA9IHRvdWNoLmNsaWVudFk7XG4gICAgICAgICAgICBpc1N3aXBpbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgdGhpcy50b3VjaFRpbWVyID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudG91Y2hUaW1lciA9IG51bGw7XG4gICAgICAgICAgICAgICAgaWYgKCFpc1N3aXBpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTG9uZy1wcmVzcyBhY3RzIHB1cmVseSBhcyBhIG11bHRpLXNlbGVjdCB0b2dnbGUgKGxpa2UgQ3RybCtDbGljaylcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlVGFnSW50ZXJhY3Rpb24odHJ1ZSwgZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCA1MDApO1xuICAgICAgICB9LCB7IHBhc3NpdmU6IHRydWUgfSk7XG5cbiAgICAgICAgdGFnRWwuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdG91Y2ggPSBlLnRvdWNoZXNbMF07XG4gICAgICAgICAgICBjb25zdCBkZWx0YVggPSB0b3VjaC5jbGllbnRYIC0gdG91Y2hTdGFydFg7XG4gICAgICAgICAgICBjb25zdCBkZWx0YVkgPSB0b3VjaC5jbGllbnRZIC0gdG91Y2hTdGFydFk7XG5cbiAgICAgICAgICAgIGlmICghaXNTd2lwaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKGRlbHRhWCkgPiAxMCAmJiBNYXRoLmFicyhkZWx0YVgpID4gTWF0aC5hYnMoZGVsdGFZKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50b3VjaFRpbWVyKSB7IHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy50b3VjaFRpbWVyKTsgdGhpcy50b3VjaFRpbWVyID0gbnVsbDsgfVxuICAgICAgICAgICAgICAgICAgICBpc1N3aXBpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoTWF0aC5hYnMoZGVsdGFZKSA+IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvdWNoVGltZXIpIHsgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLnRvdWNoVGltZXIpOyB0aGlzLnRvdWNoVGltZXIgPSBudWxsOyB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpc1N3aXBpbmcgJiYgZGVsdGFYIDwgMCkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjYXBwZWQgPSBNYXRoLm1heChkZWx0YVgsIC05MCk7XG4gICAgICAgICAgICAgICAgdGFnRWwuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoJHtjYXBwZWR9cHgpYDtcbiAgICAgICAgICAgICAgICB0YWdFbC5zdHlsZS5vcGFjaXR5ID0gU3RyaW5nKDAuNSArIChNYXRoLmFicyhjYXBwZWQpIC8gOTApICogMC41KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgeyBwYXNzaXZlOiBmYWxzZSB9KTtcblxuICAgICAgICB0YWdFbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRvdWNoID0gZS5jaGFuZ2VkVG91Y2hlc1swXTtcbiAgICAgICAgICAgIGNvbnN0IGRlbHRhWCA9IHRvdWNoLmNsaWVudFggLSB0b3VjaFN0YXJ0WDtcblxuICAgICAgICAgICAgdGFnRWwuc3R5bGUudHJhbnNpdGlvbiA9IFwidHJhbnNmb3JtIDAuMnMgZWFzZSwgb3BhY2l0eSAwLjJzIGVhc2VcIjtcbiAgICAgICAgICAgIHRhZ0VsLnN0eWxlLnRyYW5zZm9ybSA9IFwiXCI7XG4gICAgICAgICAgICB0YWdFbC5zdHlsZS5vcGFjaXR5ID0gXCJcIjtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyB0YWdFbC5zdHlsZS50cmFuc2l0aW9uID0gXCJcIjsgfSwgMjIwKTtcblxuICAgICAgICAgICAgaWYgKGlzU3dpcGluZykge1xuICAgICAgICAgICAgICAgIGlzU3dpcGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChkZWx0YVggPD0gLTYwKSBoYW5kbGVUYWdJbnRlcmFjdGlvbihmYWxzZSwgZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMudG91Y2hUaW1lcikge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy50b3VjaFRpbWVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRvdWNoVGltZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgIC8vIEl0IHdhcyBhIHNob3J0IHRhcC4gQ2FsbCBoYW5kbGVUYWdJbnRlcmFjdGlvbiBub3JtYWxseS5cbiAgICAgICAgICAgICAgICBoYW5kbGVUYWdJbnRlcmFjdGlvbihmYWxzZSwgZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG4gICAgICAgIHRhZ0VsLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGNhbmNlbFwiLCAoKSA9PiB7XG4gICAgICAgICAgICBpc1N3aXBpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmICh0aGlzLnRvdWNoVGltZXIpIHsgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLnRvdWNoVGltZXIpOyB0aGlzLnRvdWNoVGltZXIgPSBudWxsOyB9XG4gICAgICAgICAgICB0YWdFbC5zdHlsZS50cmFuc2l0aW9uID0gXCJ0cmFuc2Zvcm0gMC4ycyBlYXNlLCBvcGFjaXR5IDAuMnMgZWFzZVwiO1xuICAgICAgICAgICAgdGFnRWwuc3R5bGUudHJhbnNmb3JtID0gXCJcIjtcbiAgICAgICAgICAgIHRhZ0VsLnN0eWxlLm9wYWNpdHkgPSBcIlwiO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHRhZ0VsLnN0eWxlLnRyYW5zaXRpb24gPSBcIlwiOyB9LCAyMjApO1xuICAgICAgICB9LCB7IHBhc3NpdmU6IHRydWUgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBnZXRGaWx0ZXJlZFRhZ3NBc3luYygpOiBQcm9taXNlPE1hcDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICAgICAgbGV0IGZpbHRlcmVkVGFncyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG5cbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRUYWdzLnNpemUgPT09IDApIHtcbiAgICAgICAgICAgIGZpbHRlcmVkVGFncyA9IG5ldyBNYXAodGhpcy5hbGxUYWdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkVGFnc0FycmF5ID0gQXJyYXkuZnJvbSh0aGlzLnNlbGVjdGVkVGFncyk7XG4gICAgICAgICAgICBjb25zdCBtYXRjaGluZ0ZpbGVzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgICAgdGhpcy50YWdzQnlGaWxlLmZvckVhY2goKHRhZ3NBcnIsIGZpbGVQYXRoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkVGFnc0FycmF5LmV2ZXJ5KHRhZyA9PiB0YWdzQXJyLmluY2x1ZGVzKHRhZykpKSB7XG4gICAgICAgICAgICAgICAgICAgIG1hdGNoaW5nRmlsZXMucHVzaChmaWxlUGF0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaE1vZGUgPT09IFwibm90ZVwiKSB7XG4gICAgICAgICAgICAgICAgbWF0Y2hpbmdGaWxlcy5mb3JFYWNoKGZpbGVQYXRoID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZVRhZ3MgPSB0aGlzLnRhZ3NCeUZpbGUuZ2V0KGZpbGVQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVUYWdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlVGFncy5mb3JFYWNoKHRhZyA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRUYWdzLnNldCh0YWcsIChmaWx0ZXJlZFRhZ3MuZ2V0KHRhZykgfHwgMCkgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZVBhdGggb2YgbWF0Y2hpbmdGaWxlcykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNhY2hlZFJlYWQoZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoJ1xcbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG93ZXJMaW5lID0gbGluZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaE1vZGUgPT09IFwidGFza1wiICYmICFsb3dlckxpbmUuaW5jbHVkZXMoXCItIFtcIikpIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaE1vZGUgPT09IFwidGFzay10b2RvXCIgJiYgIWxvd2VyTGluZS5pbmNsdWRlcyhcIi0gWyBdXCIpKSBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWFyY2hNb2RlID09PSBcInRhc2stZG9uZVwiICYmICFsb3dlckxpbmUuaW5jbHVkZXMoXCItIFt4XVwiKSkgY29udGludWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaW5lVGFncyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhZ1JlZ2V4ID0gLyMoW15cXHMjXSspL2c7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1hdGNoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgobWF0Y2ggPSB0YWdSZWdleC5leGVjKGxpbmUpKSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lVGFncy5hZGQobWF0Y2hbMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRUYWdzQXJyYXkuZXZlcnkoc2VsZWN0ZWRUYWcgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShsaW5lVGFncykuc29tZSh0ID0+IHQudG9Mb3dlckNhc2UoKSA9PT0gc2VsZWN0ZWRUYWcudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZVRhZ3MuZm9yRWFjaCh0YWcgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRUYWdzLnNldCh0YWcsIChmaWx0ZXJlZFRhZ3MuZ2V0KHRhZykgfHwgMCkgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZWxlY3RlZFRhZ3NBcnJheS5mb3JFYWNoKHRhZyA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXJlZFRhZ3MuaGFzKHRhZykpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRUYWdzLnNldCh0YWcsIHRoaXMuYWxsVGFncy5nZXQodGFnKSB8fCAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIEFycmF5LmZyb20odGhpcy5leGNsdWRlZFRhZ3MpLmZvckVhY2godGFnID0+IHtcbiAgICAgICAgICAgIGlmICghZmlsdGVyZWRUYWdzLmhhcyh0YWcpKSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWRUYWdzLnNldCh0YWcsIHRoaXMuYWxsVGFncy5nZXQodGFnKSB8fCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgY3V0b2ZmRW5hYmxlZCA9IHRoaXMucGx1Z2luLnNldHRpbmdzPy5mcmVxdWVuY3lDdXRvZmZFbmFibGVkID8/IGZhbHNlO1xuICAgICAgICBjb25zdCBjdXRvZmYgPSBjdXRvZmZFbmFibGVkID8gKHRoaXMucGx1Z2luLnNldHRpbmdzPy5mcmVxdWVuY3lDdXRvZmYgfHwgMCkgOiAwO1xuICAgICAgICBjb25zdCBzYWZlUGlubmVkID0gdGhpcy5wbHVnaW4uc2V0dGluZ3M/LnBpbm5lZFRhZ3MgfHwgW107XG5cbiAgICAgICAgaWYgKGN1dG9mZiA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gICAgICAgICAgICBmaWx0ZXJlZFRhZ3MuZm9yRWFjaCgoY291bnQsIHRhZykgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjb3VudCA+PSBjdXRvZmYgfHwgdGhpcy5zZWxlY3RlZFRhZ3MuaGFzKHRhZykgfHwgc2FmZVBpbm5lZC5pbmNsdWRlcyh0YWcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zZXQodGFnLCBjb3VudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmaWx0ZXJlZFRhZ3MgPSByZXN1bHQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy50YWdTZWFyY2hUZXh0KSB7XG4gICAgICAgICAgICBjb25zdCBzZWFyY2hUZXh0ID0gdGhpcy50YWdTZWFyY2hUZXh0LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICAgICAgICAgICAgZmlsdGVyZWRUYWdzLmZvckVhY2goKGNvdW50LCB0YWcpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGFnLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoVGV4dCkgfHwgdGhpcy5zZWxlY3RlZFRhZ3MuaGFzKHRhZykgfHwgdGhpcy5leGNsdWRlZFRhZ3MuaGFzKHRhZykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNldCh0YWcsIGNvdW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmlsdGVyZWRUYWdzO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgdXBkYXRlU2VhcmNoKG9wdGlvbnM/OiB7IHJldmVhbFNlYXJjaD86IGJvb2xlYW47IGNyZWF0ZUlmTWlzc2luZz86IGJvb2xlYW4gfSkge1xuICAgICAgICBjb25zdCB3b3Jrc3BhY2UgPSB0aGlzLmFwcC53b3Jrc3BhY2U7XG4gICAgICAgIGNvbnN0IHByZXZMZWFmID0gd29ya3NwYWNlLmFjdGl2ZUxlYWY7XG5cbiAgICAgICAgY29uc3QgaXNUb3VjaENvbnRleHQgPSBQbGF0Zm9ybS5pc01vYmlsZSB8fCB0aGlzLmxhc3RJbnRlcmFjdGlvbldhc1RvdWNoO1xuICAgICAgICBjb25zdCByZXZlYWxTZWFyY2ggPSBvcHRpb25zPy5yZXZlYWxTZWFyY2ggPz8gIWlzVG91Y2hDb250ZXh0O1xuICAgICAgICBjb25zdCBjcmVhdGVJZk1pc3NpbmcgPSBvcHRpb25zPy5jcmVhdGVJZk1pc3NpbmcgPz8gIWlzVG91Y2hDb250ZXh0O1xuXG4gICAgICAgIGxldCBzZWFyY2hMZWFmID0gd29ya3NwYWNlLmdldExlYXZlc09mVHlwZShcInNlYXJjaFwiKVswXTtcblxuICAgICAgICBpZiAoIXNlYXJjaExlYWYgJiYgY3JlYXRlSWZNaXNzaW5nKSB7XG4gICAgICAgICAgICBjb25zdCByaWdodExlYWYgPSB3b3Jrc3BhY2UuZ2V0UmlnaHRMZWFmKHRydWUpO1xuICAgICAgICAgICAgaWYgKHJpZ2h0TGVhZikge1xuICAgICAgICAgICAgICAgIHNlYXJjaExlYWYgPSByaWdodExlYWY7XG4gICAgICAgICAgICAgICAgYXdhaXQgc2VhcmNoTGVhZi5zZXRWaWV3U3RhdGUoeyB0eXBlOiBcInNlYXJjaFwiLCBhY3RpdmU6IGZhbHNlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNlYXJjaExlYWYgJiYgcmV2ZWFsU2VhcmNoKSB7XG4gICAgICAgICAgICB3b3Jrc3BhY2UucmV2ZWFsTGVhZihzZWFyY2hMZWFmKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwcmV2TGVhZikge1xuICAgICAgICAgICAgd29ya3NwYWNlLnNldEFjdGl2ZUxlYWYocHJldkxlYWYsIHsgZm9jdXM6IHRydWUgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmxhc3RJbnRlcmFjdGlvbldhc1RvdWNoID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKCFzZWFyY2hMZWFmKSByZXR1cm47XG5cbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRUYWdzLnNpemUgPT09IDAgJiYgdGhpcy5leGNsdWRlZFRhZ3Muc2l6ZSA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3Qgc2VhcmNoVmlldyA9IHNlYXJjaExlYWYudmlldyBhcyBhbnk7XG4gICAgICAgICAgICBpZiAoc2VhcmNoVmlldykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNsZWFyQnRuID0gc2VhcmNoVmlldy5jb250YWluZXJFbC5xdWVyeVNlbGVjdG9yKCcuc2VhcmNoLWlucHV0LWNsZWFyLWJ1dHRvbicpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICAgICAgICAgIGlmIChjbGVhckJ0bikge1xuICAgICAgICAgICAgICAgICAgICBjbGVhckJ0bi5kaXNwYXRjaEV2ZW50KG5ldyBNb3VzZUV2ZW50KFwiY2xpY2tcIiwgeyBidWJibGVzOiB0cnVlLCBjYW5jZWxhYmxlOiBmYWxzZSB9KSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc2VhcmNoVmlldy5zZXRRdWVyeSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaFZpZXcuc2V0UXVlcnkoXCJcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRhZ1F1ZXJ5ID0gXCJcIjtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBBcnJheS5mcm9tKHRoaXMuc2VsZWN0ZWRUYWdzKTtcbiAgICAgICAgY29uc3QgZXhjbHVkZWQgPSBBcnJheS5mcm9tKHRoaXMuZXhjbHVkZWRUYWdzKTtcblxuICAgICAgICBpZiAodGhpcy5zZWFyY2hNb2RlID09PSBcIm5vdGVcIikge1xuICAgICAgICAgICAgdGFnUXVlcnkgPSBbXG4gICAgICAgICAgICAgICAgLi4uc2VsZWN0ZWQubWFwKHRhZyA9PiBgdGFnOiMke3RhZ31gKSxcbiAgICAgICAgICAgICAgICAuLi5leGNsdWRlZC5tYXAodGFnID0+IGAtdGFnOiMke3RhZ31gKVxuICAgICAgICAgICAgXS5qb2luKFwiIFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBwcmVmaXggPSBcImxpbmU6KFwiO1xuICAgICAgICAgICAgaWYgKHRoaXMuc2VhcmNoTW9kZSA9PT0gXCJ0YXNrXCIpIHByZWZpeCA9IFwidGFzazooXCI7XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLnNlYXJjaE1vZGUgPT09IFwidGFzay10b2RvXCIpIHByZWZpeCA9IFwidGFzay10b2RvOihcIjtcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuc2VhcmNoTW9kZSA9PT0gXCJ0YXNrLWRvbmVcIikgcHJlZml4ID0gXCJ0YXNrLWRvbmU6KFwiO1xuICAgICAgICAgICAgY29uc3QgYmxvY2tDb250ZW50cyA9IFtcbiAgICAgICAgICAgICAgICAuLi5zZWxlY3RlZC5tYXAodGFnID0+IGAjJHt0YWd9YCksXG4gICAgICAgICAgICAgICAgLi4uZXhjbHVkZWQubWFwKHRhZyA9PiBgLSMke3RhZ31gKVxuICAgICAgICAgICAgXS5qb2luKFwiIFwiKTtcbiAgICAgICAgICAgIHRhZ1F1ZXJ5ID0gYCR7cHJlZml4fSAke2Jsb2NrQ29udGVudHN9IClgO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc2VhcmNoVmlldyA9IHNlYXJjaExlYWYudmlldyBhcyBhbnk7XG4gICAgICAgIGlmIChzZWFyY2hWaWV3ICYmIHR5cGVvZiBzZWFyY2hWaWV3LnNldFF1ZXJ5ID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHNlYXJjaFZpZXcuc2V0UXVlcnkodGFnUXVlcnkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0RmlsZVRhZ3MoZmlsZTogVEZpbGUpOiBzdHJpbmdbXSB7XG4gICAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7XG4gICAgICAgIGlmICghY2FjaGUpIHJldHVybiBbXTtcbiAgICAgICAgY29uc3QgdGFnczogc3RyaW5nW10gPSBbXTtcblxuICAgICAgICBpZiAoY2FjaGUudGFncykge1xuICAgICAgICAgICAgY2FjaGUudGFncy5mb3JFYWNoKHRhZ09iaiA9PiB7XG4gICAgICAgICAgICAgICAgdGFncy5wdXNoKHRhZ09iai50YWcucmVwbGFjZSgvXiMvLCBcIlwiKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjYWNoZS5mcm9udG1hdHRlciAmJiBjYWNoZS5mcm9udG1hdHRlci50YWdzKSB7XG4gICAgICAgICAgICBjb25zdCBmbVRhZ3MgPSBjYWNoZS5mcm9udG1hdHRlci50YWdzO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBmbVRhZ3MgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgZm1UYWdzLnNwbGl0KC9bXFxzLF0rLykuZmlsdGVyKEJvb2xlYW4pLmZvckVhY2godGFnID0+IHsgdGFncy5wdXNoKHRhZyk7IH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGZtVGFncykpIHtcbiAgICAgICAgICAgICAgICBmbVRhZ3MuZm9yRWFjaCh0YWcgPT4geyBpZiAodGFnKSB0YWdzLnB1c2goU3RyaW5nKHRhZykpOyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0YWdzO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3luY0N1dG9mZkNvbnRyb2xzRnJvbVNldHRpbmdzKCkge1xuICAgICAgICBpZiAoIXRoaXMuY3V0b2ZmVG9nZ2xlQnRuIHx8ICF0aGlzLmN1dG9mZklucHV0KSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgZW5hYmxlZCA9IHRoaXMucGx1Z2luLnNldHRpbmdzPy5mcmVxdWVuY3lDdXRvZmZFbmFibGVkID8/IGZhbHNlO1xuICAgICAgICBjb25zdCBjdXRvZmYgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncz8uZnJlcXVlbmN5Q3V0b2ZmID8/IDA7XG5cbiAgICAgICAgdGhpcy5jdXRvZmZJbnB1dC52YWx1ZSA9IFN0cmluZyhjdXRvZmYpO1xuICAgICAgICB0aGlzLmN1dG9mZklucHV0LmRpc2FibGVkID0gIWVuYWJsZWQ7XG5cbiAgICAgICAgdGhpcy5jdXRvZmZUb2dnbGVCdG4ucmVtb3ZlQ2xhc3MoXCJpcy1lbmFibGVkXCIpO1xuICAgICAgICB0aGlzLmN1dG9mZlRvZ2dsZUJ0bi5yZW1vdmVDbGFzcyhcImlzLWRpc2FibGVkXCIpO1xuXG4gICAgICAgIGlmIChlbmFibGVkKSB7XG4gICAgICAgICAgICB0aGlzLmN1dG9mZlRvZ2dsZUJ0bi5hZGRDbGFzcyhcImlzLWVuYWJsZWRcIik7XG4gICAgICAgICAgICBzZXRJY29uKHRoaXMuY3V0b2ZmVG9nZ2xlQnRuLCBcImV5ZVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY3V0b2ZmVG9nZ2xlQnRuLmFkZENsYXNzKFwiaXMtZGlzYWJsZWRcIik7XG4gICAgICAgICAgICBzZXRJY29uKHRoaXMuY3V0b2ZmVG9nZ2xlQnRuLCBcImV5ZS1vZmZcIik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlTW9kZVVJKHNraXBTZWFyY2g6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgICAgICBpZiAoIXRoaXMuc29ydEF6QnRuIHx8ICF0aGlzLnNvcnRDb3VudEJ0biB8fCAhdGhpcy5zY29wZUJ0biB8fCAhdGhpcy50YXNrQnRuKSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5zb3J0QXpCdG4ucmVtb3ZlQ2xhc3MoXCJpcy1hY3RpdmVcIik7XG4gICAgICAgIHRoaXMuc29ydENvdW50QnRuLnJlbW92ZUNsYXNzKFwiaXMtYWN0aXZlXCIpO1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50U29ydCA9PT0gXCJhelwiKSB0aGlzLnNvcnRBekJ0bi5hZGRDbGFzcyhcImlzLWFjdGl2ZVwiKTtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudFNvcnQgPT09IFwiY291bnRcIikgdGhpcy5zb3J0Q291bnRCdG4uYWRkQ2xhc3MoXCJpcy1hY3RpdmVcIik7XG5cbiAgICAgICAgdGhpcy5zY29wZUJ0bi5yZW1vdmVDbGFzcyhcImlzLWFjdGl2ZVwiKTtcbiAgICAgICAgdGhpcy50YXNrQnRuLnJlbW92ZUNsYXNzKFwiaXMtYWN0aXZlXCIpO1xuXG4gICAgICAgIGlmICh0aGlzLnNlYXJjaE1vZGUgPT09IFwibm90ZVwiKSB7XG4gICAgICAgICAgICB0aGlzLnNjb3BlQnRuLnNldFRleHQoXCJOT1RFXCIpO1xuICAgICAgICAgICAgdGhpcy5zY29wZUJ0bi5hZGRDbGFzcyhcImlzLWFjdGl2ZVwiKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNlYXJjaE1vZGUgPT09IFwibGluZVwiKSB7XG4gICAgICAgICAgICB0aGlzLnNjb3BlQnRuLnNldFRleHQoXCJMSU5FXCIpO1xuICAgICAgICAgICAgdGhpcy5zY29wZUJ0bi5hZGRDbGFzcyhcImlzLWFjdGl2ZVwiKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNlYXJjaE1vZGUgPT09IFwidGFza1wiKSB7XG4gICAgICAgICAgICB0aGlzLnRhc2tCdG4uc2V0VGV4dChcIlRBU0stQUxMXCIpO1xuICAgICAgICAgICAgdGhpcy50YXNrQnRuLmFkZENsYXNzKFwiaXMtYWN0aXZlXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc2VhcmNoTW9kZSA9PT0gXCJ0YXNrLXRvZG9cIikge1xuICAgICAgICAgICAgdGhpcy50YXNrQnRuLnNldFRleHQoXCJUQVNLLVRPRE9cIik7XG4gICAgICAgICAgICB0aGlzLnRhc2tCdG4uYWRkQ2xhc3MoXCJpcy1hY3RpdmVcIik7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWFyY2hNb2RlID09PSBcInRhc2stZG9uZVwiKSB7XG4gICAgICAgICAgICB0aGlzLnRhc2tCdG4uc2V0VGV4dChcIlRBU0stRE9ORVwiKTtcbiAgICAgICAgICAgIHRoaXMudGFza0J0bi5hZGRDbGFzcyhcImlzLWFjdGl2ZVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChbXCJub3RlXCIsIFwibGluZVwiXS5pbmNsdWRlcyh0aGlzLnNlYXJjaE1vZGUpKSB7XG4gICAgICAgICAgICBpZiAoIVtcIlRBU0stQUxMXCIsIFwiVEFTSy1UT0RPXCIsIFwiVEFTSy1ET05FXCJdLmluY2x1ZGVzKHRoaXMudGFza0J0bi5pbm5lclRleHQpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50YXNrQnRuLnNldFRleHQoXCJUQVNLLUFMTFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICghW1wiTk9URVwiLCBcIkxJTkVcIl0uaW5jbHVkZXModGhpcy5zY29wZUJ0bi5pbm5lclRleHQpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY29wZUJ0bi5zZXRUZXh0KFwiTk9URVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghc2tpcFNlYXJjaCkge1xuICAgICAgICAgICAgdm9pZCB0aGlzLnVwZGF0ZVNlYXJjaCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMudGFnQ29udGFpbmVyKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlclRhZ3MoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyB0b2dnbGVTY29wZU1vZGUoKSB7XG4gICAgICAgIGlmICghdGhpcy5zY29wZUJ0bikgcmV0dXJuO1xuICAgICAgICBpZiAoW1wibm90ZVwiLCBcImxpbmVcIl0uaW5jbHVkZXModGhpcy5zZWFyY2hNb2RlKSkge1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hNb2RlID0gdGhpcy5zZWFyY2hNb2RlID09PSBcIm5vdGVcIiA/IFwibGluZVwiIDogXCJub3RlXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNlYXJjaE1vZGUgPSB0aGlzLnNjb3BlQnRuLmlubmVyVGV4dCA9PT0gXCJMSU5FXCIgPyBcImxpbmVcIiA6IFwibm90ZVwiO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudXBkYXRlTW9kZVVJKCk7XG4gICAgfVxuXG4gICAgcHVibGljIHRvZ2dsZVRhc2tNb2RlKCkge1xuICAgICAgICBpZiAoIXRoaXMudGFza0J0bikgcmV0dXJuO1xuICAgICAgICBpZiAoW1widGFza1wiLCBcInRhc2stdG9kb1wiLCBcInRhc2stZG9uZVwiXS5pbmNsdWRlcyh0aGlzLnNlYXJjaE1vZGUpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zZWFyY2hNb2RlID09PSBcInRhc2tcIikgdGhpcy5zZWFyY2hNb2RlID0gXCJ0YXNrLXRvZG9cIjtcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuc2VhcmNoTW9kZSA9PT0gXCJ0YXNrLXRvZG9cIikgdGhpcy5zZWFyY2hNb2RlID0gXCJ0YXNrLWRvbmVcIjtcbiAgICAgICAgICAgIGVsc2UgdGhpcy5zZWFyY2hNb2RlID0gXCJ0YXNrXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy50YXNrQnRuLmlubmVyVGV4dCA9PT0gXCJUQVNLLVRPRE9cIikgdGhpcy5zZWFyY2hNb2RlID0gXCJ0YXNrLXRvZG9cIjtcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMudGFza0J0bi5pbm5lclRleHQgPT09IFwiVEFTSy1ET05FXCIpIHRoaXMuc2VhcmNoTW9kZSA9IFwidGFzay1kb25lXCI7XG4gICAgICAgICAgICBlbHNlIHRoaXMuc2VhcmNoTW9kZSA9IFwidGFza1wiO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudXBkYXRlTW9kZVVJKCk7XG4gICAgfVxuXG4gICAgcHVibGljIHRvZ2dsZVNvcnQoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFNvcnQgPSB0aGlzLmN1cnJlbnRTb3J0ID09PSBcImF6XCIgPyBcImNvdW50XCIgOiBcImF6XCI7XG4gICAgICAgIHRoaXMudXBkYXRlTW9kZVVJKHRydWUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjbGVhclRhZ1NlbGVjdGlvbnMoKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRUYWdzLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuZXhjbHVkZWRUYWdzLmNsZWFyKCk7XG4gICAgICAgIHRoaXMucmVuZGVyVGFncygpO1xuICAgICAgICB2b2lkIHRoaXMudXBkYXRlU2VhcmNoKHsgcmV2ZWFsU2VhcmNoOiBmYWxzZSwgY3JlYXRlSWZNaXNzaW5nOiBmYWxzZSB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY2xlYXJTZWFyY2hCb3goKSB7XG4gICAgICAgIGNvbnN0IHNlYXJjaEJveCA9IHRoaXMuY29udGVudEVsLnF1ZXJ5U2VsZWN0b3IoJy5mbGF0LXRhZy1zZWFyY2gtaW5wdXQnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICBpZiAoc2VhcmNoQm94KSB7XG4gICAgICAgICAgICBzZWFyY2hCb3gudmFsdWUgPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy50YWdTZWFyY2hUZXh0ID0gXCJcIjtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyVGFncygpO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwgImV4cG9ydCBjb25zdCBWSUVXX1RZUEUgPSBcImZsYXQtdGFnLXZpZXdcIjtcblxuIiwgImV4cG9ydCBjb25zdCBnZXRTdHlsZXMgPSAoKTogc3RyaW5nID0+IHtcbiAgcmV0dXJuIGBcbiAgICAud29ya3NwYWNlLXNwbGl0Lm1vZC1yb290IC52aWV3LWNvbnRlbnQuZmxhdC10YWctdmlldyB7XG4gICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgICAgIGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDtcbiAgICAgIGFsaWduLWl0ZW1zOiBzdHJldGNoO1xuICAgICAgaGVpZ2h0OiAxMDAlO1xuICAgICAgcGFkZGluZzogMDtcbiAgICAgIG1hcmdpbjogMDtcbiAgICB9XG5cbiAgICAuZmxhdC10YWctY29udGFpbmVyIHtcbiAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICAgICAgYWxpZ24taXRlbXM6IGZsZXgtc3RhcnQ7XG4gICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtc3RhcnQ7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIGhlaWdodDogMTAwJTtcbiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gICAgICBwYWRkaW5nOiAwO1xuICAgICAgbWFyZ2luOiAwO1xuICAgIH1cblxuICAgIC5mbGF0LXRhZy1zb3J0LWNvbnRhaW5lciB7XG4gICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgIGZsZXgtc2hyaW5rOiAwO1xuICAgICAgcGFkZGluZzogOHB4O1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmFja2dyb3VuZC1wcmltYXJ5KTtcbiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIGZsZXgtd3JhcDogd3JhcDtcbiAgICAgIGdhcDogOHB4O1xuICAgIH1cblxuICAgIC5mbGF0LXRhZy1idXR0b25zLXNlY3Rpb24ge1xuICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgIGdhcDogNnB4O1xuICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgIGZsZXgtd3JhcDogd3JhcDtcbiAgICB9XG5cbiAgICAuZmxhdC10YWctbW9kZS1idXR0b24ge1xuICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgcGFkZGluZzogNHB4IDEwcHg7XG4gICAgICBmb250LXNpemU6IDAuOGVtO1xuICAgICAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLXJhZGl1cy1zKTtcbiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItZm9ybS1maWVsZCk7XG4gICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7XG4gICAgICB0cmFuc2l0aW9uOiBhbGwgMC4xNXMgZWFzZS1pbi1vdXQ7XG4gICAgICB1c2VyLXNlbGVjdDogbm9uZTtcbiAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgICBtaW4td2lkdGg6IDY1cHg7XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnLW1vZGUtYnV0dG9uOmhvdmVyIHtcbiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW5vcm1hbCk7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWhvdmVyKTtcbiAgICAgIGJvcmRlci1jb2xvcjogdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXItaG92ZXIpO1xuICAgIH1cblxuICAgIC5mbGF0LXRhZy1tb2RlLWJ1dHRvbi5pcy1hY3RpdmUge1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0taW50ZXJhY3RpdmUtYWNjZW50KTtcbiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW9uLWFjY2VudCk7XG4gICAgICBib3JkZXItY29sb3I6IHZhcigtLWludGVyYWN0aXZlLWFjY2VudCk7XG4gICAgICBib3gtc2hhZG93OiBpbnNldCAwIDFweCAzcHggcmdiYSgwLCAwLCAwLCAwLjIpO1xuICAgIH1cblxuICAgIC5mbGF0LXRhZy1tb2RlLWJ1dHRvbi5pcy1hY3RpdmU6aG92ZXIge1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0taW50ZXJhY3RpdmUtYWNjZW50LWhvdmVyKTtcbiAgICAgIGJvcmRlci1jb2xvcjogdmFyKC0taW50ZXJhY3RpdmUtYWNjZW50LWhvdmVyKTtcbiAgICB9XG5cbiAgICAuZmxhdC10YWctc2VhcmNoLXNlY3Rpb24ge1xuICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICBnYXA6IDRweDtcbiAgICAgIG1hcmdpbi1sZWZ0OiBhdXRvO1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmFja2dyb3VuZC1zZWNvbmRhcnkpO1xuICAgICAgYm9yZGVyLXJhZGl1czogNHB4O1xuICAgICAgcGFkZGluZzogMnB4IDhweDtcbiAgICAgIGZsZXgtZ3JvdzogMTtcbiAgICAgIG1heC13aWR0aDogMjAwcHg7XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnLXNlYXJjaC1pbnB1dCB7XG4gICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDtcbiAgICAgIGJvcmRlcjogbm9uZTtcbiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW5vcm1hbCk7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIGhlaWdodDogMjRweDtcbiAgICAgIGZvbnQtc2l6ZTogMC45ZW07XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnLXNlYXJjaC1pbnB1dDpmb2N1cyB7XG4gICAgICBvdXRsaW5lOiBub25lO1xuICAgICAgYm94LXNoYWRvdzogbm9uZTtcbiAgICB9XG5cbiAgICAuZmxhdC10YWctc2VhcmNoLWNsZWFyLWJ1dHRvbiB7XG4gICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7XG4gICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgZm9udC1zaXplOiAwLjhlbTtcbiAgICB9XG5cbiAgICAuZmxhdC10YWctc2VhcmNoLWNsZWFyLWJ1dHRvbjpob3ZlciB7XG4gICAgICBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpO1xuICAgIH1cblxuICAgIC5mbGF0LXRhZy1zb3J0LWJ1dHRvbiwgLmZsYXQtdGFnLWNsZWFyLWJ1dHRvbiB7XG4gICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICBwYWRkaW5nOiA0cHg7XG4gICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgIH1cblxuICAgIC5mbGF0LXRhZy1zb3J0LWJ1dHRvbjpob3ZlciwgLmZsYXQtdGFnLWNsZWFyLWJ1dHRvbjpob3ZlciB7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1pbnRlcmFjdGl2ZS1ob3Zlcik7XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnLXNvcnQtYnV0dG9uLmlzLWFjdGl2ZSB7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1pbnRlcmFjdGl2ZS1hY2NlbnQpO1xuICAgICAgY29sb3I6IHZhcigtLXRleHQtb24tYWNjZW50KTtcbiAgICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDNweCByZ2JhKDAsIDAsIDAsIDAuMik7XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnLXNvcnQtYnV0dG9uLmlzLWFjdGl2ZTpob3ZlciB7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1pbnRlcmFjdGl2ZS1hY2NlbnQtaG92ZXIpO1xuICAgIH1cblxuICAgIC8qIEN1dG9mZiBjb250cm9scyAobGl2ZXMgaW5zaWRlIC5mbGF0LXRhZy1idXR0b25zLXNlY3Rpb24pICovXG4gICAgLmZsYXQtdGFnLWN1dG9mZi1zcGFjZXIge1xuICAgICAgZmxleDogMCAwIDhweDtcbiAgICAgIHdpZHRoOiA4cHg7XG4gICAgICBoZWlnaHQ6IDFweDtcbiAgICB9XG5cbiAgICAuZmxhdC10YWctY3V0b2ZmLXNlY3Rpb24ge1xuICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICBnYXA6IDZweDtcbiAgICAgIHBhZGRpbmc6IDJweCA4cHg7XG4gICAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1yYWRpdXMtcyk7XG4gICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7XG4gICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCB2YXIoLS1iYWNrZ3JvdW5kLXNlY29uZGFyeSkgMCUsIHZhcigtLWJhY2tncm91bmQtcHJpbWFyeSkgMTAwJSk7XG4gICAgICBib3gtc2hhZG93OiBpbnNldCAwIDFweCAwIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4wNCk7XG4gICAgICBoZWlnaHQ6IDI4cHg7XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnLWN1dG9mZi10b2dnbGUge1xuICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgZGlzcGxheTogaW5saW5lLWZsZXg7XG4gICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7XG4gICAgICBwYWRkaW5nOiAycHg7XG4gICAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1yYWRpdXMtcyk7XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnLWN1dG9mZi10b2dnbGU6aG92ZXIge1xuICAgICAgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItaG92ZXIpO1xuICAgIH1cblxuICAgIC5mbGF0LXRhZy1jdXRvZmYtdG9nZ2xlLmlzLWVuYWJsZWQge1xuICAgICAgY29sb3I6IHZhcigtLWludGVyYWN0aXZlLWFjY2VudCk7XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnLWN1dG9mZi10b2dnbGUuaXMtZGlzYWJsZWQge1xuICAgICAgb3BhY2l0eTogMC43O1xuICAgIH1cblxuICAgIC5mbGF0LXRhZy1jdXRvZmYtaW5wdXQge1xuICAgICAgd2lkdGg6IDQ0cHg7XG4gICAgICBoZWlnaHQ6IDIycHg7XG4gICAgICBib3JkZXI6IG5vbmU7XG4gICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDtcbiAgICAgIHBhZGRpbmc6IDA7XG4gICAgICBtYXJnaW46IDA7XG4gICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICBmb250LXNpemU6IDAuOWVtO1xuICAgICAgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTtcbiAgICB9XG5cbiAgICAuZmxhdC10YWctY3V0b2ZmLWlucHV0OmZvY3VzIHtcbiAgICAgIG91dGxpbmU6IG5vbmU7XG4gICAgICBib3gtc2hhZG93OiBub25lO1xuICAgIH1cblxuICAgIC5mbGF0LXRhZy1jdXRvZmYtaW5wdXQ6ZGlzYWJsZWQge1xuICAgICAgY29sb3I6IHZhcigtLXRleHQtZmFpbnQpO1xuICAgICAgY3Vyc29yOiBub3QtYWxsb3dlZDtcbiAgICB9XG5cbiAgICAuZmxhdC10YWctbGlzdCB7XG4gICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgZmxleC13cmFwOiB3cmFwO1xuICAgICAgYWxpZ24tY29udGVudDogZmxleC1zdGFydDtcbiAgICAgIG92ZXJmbG93LXk6IGF1dG87XG4gICAgICBmbGV4OiAxO1xuICAgICAgbGluZS1oZWlnaHQ6IDEuNWVtO1xuICAgICAgcGFkZGluZzogOHB4O1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnIHtcbiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICAgIHBhZGRpbmc6IDJweCA2cHg7XG4gICAgICBtYXJnaW46IDJweDtcbiAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXRhZy1iYWNrZ3JvdW5kKTtcbiAgICAgIGNvbG9yOiB2YXIoLS10YWctY29sb3IpO1xuICAgICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAwLjFzO1xuICAgIH1cblxuICAgIC5mbGF0LXRhZzpob3ZlciB7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS10YWctYmFja2dyb3VuZC1ob3Zlcik7XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnLXNlbGVjdGVkIHtcbiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkO1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0taW50ZXJhY3RpdmUtYWNjZW50KTtcbiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW9uLWFjY2VudCk7XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnLWV4Y2x1ZGVkIHtcbiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkO1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tY29sb3ItcmVkKTtcbiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW9uLWFjY2VudCk7XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnLWxldHRlciB7XG4gICAgICBkaXNwbGF5OiBpbmxpbmUtZmxleDtcbiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkO1xuICAgICAgZm9udC1zaXplOiAxLjJlbTtcbiAgICAgIG1hcmdpbjogMnB4O1xuICAgICAgcGFkZGluZzogMnB4IDZweDtcbiAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQtc2Vjb25kYXJ5KTtcbiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW5vcm1hbCk7XG4gICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgICBtaW4td2lkdGg6IDI0cHg7XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnLXBpbm5lZC1zZWN0aW9uIHtcbiAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgIGZsZXgtd3JhcDogd3JhcDtcbiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiBjb2xvci1taXgoaW4gc3JnYiwgdmFyKC0taW50ZXJhY3RpdmUtYWNjZW50KSAxMCUsIHZhcigtLWJhY2tncm91bmQtcHJpbWFyeSkpO1xuICAgICAgYm9yZGVyOiAxcHggc29saWQgY29sb3ItbWl4KGluIHNyZ2IsIHZhcigtLWludGVyYWN0aXZlLWFjY2VudCkgMjUlLCB0cmFuc3BhcmVudCk7XG4gICAgICBwYWRkaW5nOiA0cHg7XG4gICAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1yYWRpdXMtcyk7XG4gICAgICBtYXJnaW4tYm90dG9tOiA0cHg7XG4gICAgfVxuXG4gICAgLmZsYXQtdGFnLXNlcGFyYXRvciB7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIGhlaWdodDogMXB4O1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpO1xuICAgICAgbWFyZ2luOiA0cHggMCA4cHggMDtcbiAgICB9XG5cbiAgICAuZmxhdC10YWctcGlubmVkIHtcbiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWludGVyYWN0aXZlLWFjY2VudCk7XG4gICAgfVxuICBgO1xufTtcbiIsICJpbXBvcnQgeyBBcHAsIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBGbGF0VGFnUGx1Z2luIGZyb20gXCIuL21haW5cIjtcblxuZXhwb3J0IHR5cGUgQWx0Q2xpY2tUYWdNb2RlID0gXCJzdGFydC1saW5lXCIgfCBcImluLXBsYWNlXCIgfCBcImVuZC1saW5lXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmxhdFRhZ1BsdWdpblNldHRpbmdzIHtcbiAgcGlubmVkVGFnczogc3RyaW5nW107XG4gIGZyZXF1ZW5jeUN1dG9mZjogbnVtYmVyO1xuICBmcmVxdWVuY3lDdXRvZmZFbmFibGVkOiBib29sZWFuO1xuICBhbHRDbGlja1RhZ01vZGU6IEFsdENsaWNrVGFnTW9kZTtcbn1cblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfU0VUVElOR1M6IEZsYXRUYWdQbHVnaW5TZXR0aW5ncyA9IHtcbiAgcGlubmVkVGFnczogW10sXG4gIGZyZXF1ZW5jeUN1dG9mZjogMCwgLy8gMCBtZWFucyBzaG93IGFsbCB0YWdzXG4gIGZyZXF1ZW5jeUN1dG9mZkVuYWJsZWQ6IGZhbHNlLFxuICBhbHRDbGlja1RhZ01vZGU6IFwic3RhcnQtbGluZVwiLFxufTtcblxuZXhwb3J0IGNsYXNzIEZsYXRUYWdTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gIHBsdWdpbjogRmxhdFRhZ1BsdWdpbjtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBGbGF0VGFnUGx1Z2luKSB7XG4gICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICB9XG5cbiAgZGlzcGxheSgpOiB2b2lkIHtcbiAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiQWx0LWNsaWNrIGNyZWF0ZXMgdGFnXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgXCJXaGVuIHlvdSBBbHQtY2xpY2sgaW4gdGhlIGVkaXRvciwgY3JlYXRlIGEgdGFnIGZyb20gdGhlIGN1cnJlbnQgc2VsZWN0aW9uIChvciB0aGUgd29yZCBhdCBjdXJzb3IpIHVzaW5nIHRoZSBjaG9zZW4gbW9kZS5cIlxuICAgICAgKVxuICAgICAgLmFkZERyb3Bkb3duKChkZCkgPT5cbiAgICAgICAgZGRcbiAgICAgICAgICAuYWRkT3B0aW9uKFwic3RhcnQtbGluZVwiLCBcIlB1dCB0YWcgYXQgc3RhcnQgb2YgbGluZVwiKVxuICAgICAgICAgIC5hZGRPcHRpb24oXCJpbi1wbGFjZVwiLCBcIlR1cm4gd29yZCBpbnRvIHRhZyBpbiBwbGFjZVwiKVxuICAgICAgICAgIC5hZGRPcHRpb24oXCJlbmQtbGluZVwiLCBcIlB1dCB0YWcgYXQgZW5kIG9mIGxpbmVcIilcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYWx0Q2xpY2tUYWdNb2RlKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFsdENsaWNrVGFnTW9kZSA9IHZhbHVlIGFzIEFsdENsaWNrVGFnTW9kZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkZyZXF1ZW5jeSBjdXRvZmZcIilcbiAgICAgIC5zZXREZXNjKFwiSGlkZSB0YWdzIHRoYXQgYXBwZWFyIGZld2VyIHRpbWVzIHRoYW4gdGhpcyBudW1iZXIgaW4gdGhlIHZhdWx0LlwiKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZnJlcXVlbmN5Q3V0b2ZmRW5hYmxlZClcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5mcmVxdWVuY3lDdXRvZmZFbmFibGVkID0gdmFsdWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9KVxuICAgICAgKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCIwXCIpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmZyZXF1ZW5jeUN1dG9mZi50b1N0cmluZygpKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlSW50KHZhbHVlLCAxMCk7XG4gICAgICAgICAgICBpZiAoIWlzTmFOKHBhcnNlZCkgJiYgcGFyc2VkID49IDApIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZnJlcXVlbmN5Q3V0b2ZmID0gcGFyc2VkO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgKTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJDbGVhciBwaW5uZWQgdGFnc1wiKVxuICAgICAgLnNldERlc2MoXCJSZW1vdmVzIGFsbCBwaW5uZWQgdGFncyBmcm9tIHRoZSB0b3Agb2YgdGhlIGZsYXQgdGFnIGxpc3QuXCIpXG4gICAgICAuYWRkQnV0dG9uKChidG4pID0+XG4gICAgICAgIGJ0bi5zZXRCdXR0b25UZXh0KFwiQ2xlYXIgcGlubmVkXCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnBpbm5lZFRhZ3MgPSBbXTtcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLElBQUFBLG1CQUE0RTs7O0FDQTVFLHNCQUFrRTs7O0FDQTNELElBQU0sWUFBWTs7O0FESWxCLElBQU0sY0FBTixjQUEwQix5QkFBUztBQUFBLEVBMEJ0QyxZQUFZLE1BQXFCLFFBQXVCO0FBQ3BELFVBQU0sSUFBSTtBQWJkLFNBQVEsZUFBNEIsb0JBQUksSUFBSTtBQUM1QyxTQUFRLGVBQTRCLG9CQUFJLElBQUk7QUFDNUMsU0FBUSxVQUErQixvQkFBSSxJQUFJO0FBQy9DLFNBQVEsY0FBOEI7QUFFdEMsU0FBUSxhQUFvQyxvQkFBSSxJQUFJO0FBQ3BELFNBQVEsZ0JBQXdCO0FBQ2hDLFNBQVEsYUFBbUU7QUFFM0UsU0FBUSxhQUE0QjtBQUNwQyxTQUFRLDBCQUFtQztBQUl2QyxTQUFLLFNBQVM7QUFDZCxTQUFLLFlBQVksU0FBUyxlQUFlO0FBQUEsRUFDN0M7QUFBQSxFQUVBLGNBQXNCO0FBQUUsV0FBTztBQUFBLEVBQVc7QUFBQSxFQUMxQyxpQkFBeUI7QUFBRSxXQUFPO0FBQUEsRUFBYTtBQUFBLEVBQy9DLFVBQWtCO0FBQUUsV0FBTztBQUFBLEVBQU87QUFBQSxFQUVsQyxNQUFNLFNBQVM7QUFDWCxTQUFLLFlBQVksS0FBSyxVQUFVLFVBQVUsRUFBRSxLQUFLLHFCQUFxQixDQUFDO0FBRXZFLFNBQUssWUFBWSxpQkFBaUIsY0FBYyxNQUFNO0FBQ2xELFdBQUssMEJBQTBCO0FBQUEsSUFDbkMsR0FBRyxFQUFFLFNBQVMsS0FBSyxDQUFDO0FBQ3BC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TyxjQUFTLE1BQU0sV0FBVyxNQUExQixZQUErQixDQUFDO0FBQzdDLFVBQU0sU0FBUyxXQUFXLE1BQU0sR0FBRyxXQUFXLFNBQVMsU0FBUyxNQUFNO0FBRXRFLFdBQU8sRUFBRSxRQUFRLE1BQU0sV0FBVztBQUFBLEVBQ3BDO0FBQUEsRUFFQSxNQUFNLGVBQWU7QUFDbkIsU0FBSyxXQUFXLE9BQU8sT0FBTyxDQUFDLEdBQUcsa0JBQWtCLE1BQU0sS0FBSyxTQUFTLENBQUM7QUFBQSxFQUMzRTtBQUFBLEVBRUEsTUFBTSxlQUFlO0FBQ25CLFVBQU0sS0FBSyxTQUFTLEtBQUssUUFBUTtBQUNqQyxTQUFLLElBQUksVUFBVSxRQUFRLGdDQUFnQztBQUFBLEVBQzdEO0FBQUEsRUFFQSxNQUFNLFdBQVc7QUFDZixTQUFLLElBQUksVUFBVSxtQkFBbUIsU0FBUztBQUFBLEVBQ2pEO0FBQUEsRUFFQSxNQUFNLGVBQWU7QUFDbkIsVUFBTSxFQUFFLFVBQVUsSUFBSSxLQUFLO0FBRTNCLFFBQUksT0FBTyxVQUFVLGdCQUFnQixTQUFTLEVBQUUsQ0FBQztBQUNqRCxRQUFJLENBQUMsTUFBTTtBQUNULFlBQU0sWUFBWSxVQUFVLGFBQWEsS0FBSztBQUM5QyxVQUFJLFdBQVc7QUFDYixlQUFPO0FBQ1AsY0FBTSxLQUFLLGFBQWEsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUFBLE1BQzdDO0FBQUEsSUFDRjtBQUVBLFFBQUk7QUFBTSxnQkFBVSxXQUFXLElBQUk7QUFBQSxFQUNyQztBQUFBLEVBRUEsV0FBVztBQUNULFVBQU0sVUFBVSxTQUFTLGNBQWMsT0FBTztBQUM5QyxZQUFRLFlBQVksVUFBVTtBQUM5QixhQUFTLEtBQUssWUFBWSxPQUFPO0FBQUEsRUFDbkM7QUFDRjsiLAogICJuYW1lcyI6IFsiaW1wb3J0X29ic2lkaWFuIiwgIl9hIiwgInNlYXJjaFZpZXciLCAiaW1wb3J0X29ic2lkaWFuIl0KfQo=
